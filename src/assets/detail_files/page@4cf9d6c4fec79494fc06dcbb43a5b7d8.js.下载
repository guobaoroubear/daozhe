void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.announce=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.b('<div class="mp-announce-mask" id="mp-announce-mask"></div>'),o.b("\n"+i),o.b('<div class="mp-announce-detailcon" id="mp-announce-detailcon">'),o.b("\n"+i),o.b('    <div class="mp-announce-detailtitle">'),o.b("\n"+i),o.b('        <span class="mpg-iconfont mp-announce-detailicon">&#xe903;</span>景区公告'),o.b("\n"+i),o.b("    </div>"),o.b("\n"+i),o.b('    <div class="mp-announce-detail">'),o.b("\n"+i),o.s(o.f("spotAnnouncement",t,e,1),t,e,0,315,337,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b("    <p>"),o.b(o.v(o.d(".",t,e,0))),o.b("</p>"),o.b("\n"+i)}),t.pop()),o.b("    </div>"),o.b("\n"+i),o.b('    <div class="mp-announce-popclose">'),o.b("\n"+i),o.b('        <span class="mpg-iconfont mp-announce-detailcloseicon" id="mp-announce-detailclose">&#xe612;</span>'),o.b("\n"+i),o.b("    </div>"),o.b("\n"+i),o.b("</div>"),o.b("\n"),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.announce),function(t,e){"function"==typeof define?define.amd?define(function(){return e()}):define.cmd&&define(function(t,i,o){o.exports=e()}):"object"==typeof module&&"object"==typeof module.exports?module.exports=e():t.QunarAPI=e()}("undefined"!=typeof window?window:this,function(){"use strict";function t(t){return"function"==typeof t}function e(t){return"[object String]"===Object.prototype.toString.call(t)}function i(t,e){for(var i in t)r.register(i,t[i],e)}function o(){h.length>0&&(h.forEach(function(t){r.invoke(t.key,t.callback,t.param)}),h=[])}function n(t){d.length>0&&d.forEach(function(e){e(t)})}function a(e,i,o){if(i){y[o]&&(i=y[o](i));var n=i.success,a=i.fail,s=i.complete,c=function(l){p.debug&&console.log(l);var h=Array.prototype.slice.call(arguments,0);l&&void 0!==l.ret?l.ret?(h[0]=l.data,t(n)&&n.apply(null,h),b.api[o]&&b.api[o].call(i,l.data||{})):t(a)&&a.apply(null,h):(t(n)&&n.apply(null,h),b.api[o]&&b.api[o].call(i,l||{})),t(s)&&s.apply(null,h),g.qunar&&l&&-1!=l.errcode&&b.bridge.method(o)&&r.invoke(e,c,i,o)};return r.invoke(e,c,i,o)}console.error("Parameters are not allowed to be empty!")}var r={},s=window,c=s.document,l=s.navigator.userAgent,p={},h=[],d=[],u={wechatApiUrl:"//res.wx.qq.com/open/js/jweixin-1.0.0.js"},m={},f={},g=/MicroMessenger/i.test(l)?{wechat:!0,version:""}:/Qunar/i.test(l)?{qunar:!0,version:""}:{h5:!0,version:""},b={api:{openWebView:function(){t(this.onViewBack)&&r.hy.onceReceiveData({success:this.onViewBack})}},bridge:{method:function(t){return v.share.wechat[t]||v.share.hy[t]?"invoke":""}}},y={checkJsApi:function(e){var i=m,o=e.success,n=e.jsApiList.slice(0);return e.jsApiList=n.map(function(t){return i[t]||t}),e.success=function(e){var a={};n.forEach(function(t){var o=i[t]||t;a[t]=e[o]||!1}),t(o)&&o.call(null,a)},e},log:function(t){return e(t)?{message:t}:t}},v={common:{chooseImage:"chooseImage",previewImage:"previewImage",uploadImage:"uploadImage",uploadImage_v1:"uploadImage.v1",downloadImage:"downloadImage",getNetworkType:"network.getType",openLocation:"openLocation",getLocation:"geolocation.getCurrentPosition",closeWindow:"webview.back",hideOptionMenu:"hideOptionMenu",showOptionMenu:"showOptionMenu",hideMenuItems:"hideMenuItems",showMenuItems:"showMenuItems",hideAllNonBaseMenuItem:"hideAllNonBaseMenuItem",showAllNonBaseMenuItem:"showAllNonBaseMenuItem",hideLoadView:"webview.hideLoadView",onLoadingClose:"loadingview.close",scanQRCode:"scanQRCode",abTest:"abTest",checkJsApi:"checkJsApi"},share:{wechat:{onMenuShareTimeline:"onMenuShareTimeline",onMenuShareAppMessage:"onMenuShareAppMessage"},hy:{onMenuShareWeiboApp:"onMenuShareWeiboApp",onMenuShareSMS:"onMenuShareSMS",onMenuShareEmail:"onMenuShareEmail",onMenuShare:"onMenuShare",onMenuShareQunarIM:"onMenuShareQunarIM"}},hy:{openWebView:"webview.open",closeWebView:"webview.back",setWebViewAttr:"webview.attribute",getInitData:"webview.getInitData",enableBackGesture:"qunarnative.gesturesView",schemeForResult:"schemeForResult",onShow:"webview.onShow",onHide:"webview.onHide",onReceiveData:"webview.onReceiveData",onceReceiveData:"webview.onReceiveData",onCloseWebView:"webview.targetClosed",onceCloseWebView:"webview.targetClosed",onBeforeShow:"webview.onBeforeShow",onBeforeHide:"webview.onBeforeHide",onDestroy:"webview.onDestroy",navRefresh:"navigation.refresh",getNavDisplayStatus:"navigation.displayStatus",setNavDisplayStatus:"navigation.display",onNavClick:"navigation.click",setStatus:"qunarnative.status",shareTimeline:"shareTimeline",shareAppMessage:"sendAppMessage",shareWeiboApp:"shareWeiboApp",shareSMS:"shareSMS",shareEmail:"shareEmail",shareQunarIM:"shareQunarIM",shareImageToTimeline:"shareImageToTimeline",showShareItems:"doShare",getDeviceInfo:"native.getDeviceInfo",login:"login.start",syncLoginFromTouch:"syncLoginFromTouch",log:"debug.log",uelog:"hy.uelog",qaf:"qaf"},h5:{getLocation:function(t,e){navigator.geolocation?navigator.geolocation.getCurrentPosition(e.success,e.fail,{enableHighAccuracy:e.enableHighAccuracy||!0,timeout:e.timeout||5e3}):t({ret:!1,errcode:-1,errmsg:"Geolocation is not supported!"})},login:function(t,e){var i,o,n,a="";o="//user.qunar.com/mobile/login.jsp",i={ret:e.ret||encodeURIComponent(location.href),goback:e.goback||"",backUrl:e.backUrl||""};for(n in i)i.hasOwnProperty(n)&&""!==i[n]&&(a+=n+"="+i[n]);location.href=o+"?"+a},checkJsApi:function(t,e){var i,o={};(e.jsApiList||[]).forEach(function(t){i=f[t],o[t]=!!v.h5[i]}),t(o)},notSupport:function(e,i,o,n){t(e)&&e({ret:!1,errcode:-1,errmsg:'浏览器环境下不支持"'+n+'"接口调用'})}}};return r={version:"1.1.3",isReady:!1,bridge:null,sniff:g,ready:function(e){var i=this;g.qunar?c.addEventListener("WebViewJavascriptBridgeReady",function(n){i.isReady=!0,i.bridge=n.bridge,t(e)&&e.call(i),o()}):g.h5?(i.isReady=!0,t(e)&&e.call(i)):g.wechat&&t(e)&&e.call(i)},config:function(t){a("config",p=t)},error:function(e){t(e)&&d.push(e)},invoke:function(e,i,o,n){if(t(i))if(r.isReady)if(g.qunar){var a="invoke";if(0===(n=n||e).indexOf("once")?a="once":0===n.indexOf("on")&&(a="on"),this.bridge[b.bridge.method(n)||a](e,i,o),"on"==a)return i}else g.wechat?this[e]&&this[e](o):g.h5&&v.h5[v.h5[n]?n:"notSupport"](i,o,e,n);else h.push({key:e,callback:i,param:o})},off:function(e,i){if(t(i)){var o=m[e];o&&(this.bridge.off(o,i),i=null)}},register:function(t,e,i){var o=this,n=this;i&&(n=o[i]?o[i]:o[i]={}),m[t]=e,f[e]=t,n[t]=function(i){return i||(i={}),a(e,i,t)}}},i(v.share.wechat),i(v.share.hy),i(v.common),i(v.hy,"hy"),function(){if(g.wechat){var e=c.getElementsByTagName("head")[0],i=c.createElement("script");i.setAttribute("src",u.wechatApiUrl),e.appendChild(i),i.onload=function(){for(var t in wx)r[t]=wx[t];r.onMenuShare=function(t){for(var e in v.share.wechat)r[e](t)},r.isReady=!0,h.forEach(function(t){r[t.key](t.param)}),h=[]}}else g.qunar&&(r.hy.onInitData=function(e){r.hy.getInitData({success:function(i){t(e.success)&&e.success(i)}})},window.addEventListener("load",function(){setTimeout(function(){r.bridge||n({ret:!1,errcode:-1,errmsg:"bridge注入失败"})},600)}))}(),r}),function(t){var e=t.hy.openWebView;t.hy.openWebView=function(t){0!=t.url.indexOf("http")&&0!=t.url.indexOf("https")&&(t.url=location.protocol+t.url),e(t)}}(QunarAPI),$.provide("ptouch.page.Dot"),ptouch.page.Dot=function(t){this.context=t,this.analytics=ptouch.Analytics.getInstance()},ptouch.page.Dot.prototype.handlePageReady=function(){this.context&&this.context.touchTimeObj&&this.context.touchTimeObj.windowStartTime&&(this.analytics.dispatch("fe",{a:"touch_firstscreen_time",value:{firstScreenTime:+new Date-this.context.touchTimeObj.windowStartTime,url:window.location.href}}),$(document).listen("touchstart",this.handleFirstTouch,this))},ptouch.page.Dot.prototype.handleFirstTouch=function(){$(document).unlisten("touchstart",this.handleFirstTouch,this),this.analytics.dispatch("fe",{a:"touch_firsttouch_time",value:{firstTouchTime:+new Date-this.context.touchTimeObj.windowStartTime,url:window.location.href}})},ptouch.page.Dot.prototype.dispatchException=function(t){this.analytics.dispatchException(t)},ptouch.page.Dot.prototype.dispatchTimeConsume=function(){var t=this.context.touchTimeObj;t&&t.windowStartTime&&t.cssLoadedTime&&t.scriptsStartTime&&t.scriptsLoadedTime&&this.analytics.dispatch("fe",{a:"touch_page_time",value:{cssLoadTime:t.cssLoadedTime-t.windowStartTime,htmlShowTime:t.scriptsStartTime-t.cssLoadedTime,jsLoadTime:t.scriptsLoadedTime-t.scriptsStartTime,jsRunTime:+new Date-t.scriptsLoadedTime,url:window.location.href}})},ptouch.page.Dot.prototype.dispatchClick=function(t){return this.analytics.dispatchClick(t)},ptouch.page.Dot.prototype.dispatchBeacon=function(t){return this.analytics.dispatchBeacon(t)},ptouch.page.Dot.prototype.getGlobalParams=function(){return{s:this.analytics.getPageId(),gid:$.env.gid,vid:$.env.vid,uniid:ptouch.Analytics.getUniId()}},$.provide("ptouch.page.Util"),ptouch.page.Util.isLegalURI=function(t){for(var e=["qunar.com","qunarzz.com","baidu.com","bdimg.com","bdstatic.com","res.wx.qq.com","google.cn","google.com","gstatic.com","gstatic.cn","googleapis.com","googleapis.cn","c-ctrip.com"],i=0;i<e.length;i++)if(t.indexOf(e[i])>-1)return!0;return!1},ptouch.page.Util.handleInject=function(t){var e=t.appendChild;t.appendChild=function(i){if(i){var o=i.tagName;if("IFRAME"!=o&&"SCRIPT"!=o||ptouch.page.Util.isLegalURI(i.src))return e.call(t,i),i}}},ptouch.page.Util.openWebView=function(t,e){"app"==e?QunarAPI.ready(function(){t.url?(0!=t.url.indexOf("http")&&0!=t.url.indexOf("https")&&0!=t.url.indexOf("//")&&(t.url=location.protocol+"//"+location.host+t.url),t.type||(t.type="navibar-none"),QunarAPI.hy.openWebView(t)):alert("网页链接错误")}):t.url&&(location.href=t.url)},ptouch.page.Util.navRefresh=function(t){QunarAPI.ready(function(){QunarAPI.hy.navRefresh(t)})},ptouch.page.Util.closeWebView=function(t,e){"app"==e?QunarAPI.ready(function(){QunarAPI.hy.closeWebView(t)}):t.url?window.location.href=t.url:history.back()},ptouch.page.Util.bindShare=function(t,e,i,o,n,a){if("weixin"==this.runOn)$.getScript("//q.qunarzz.com/piao_base/prd/scripts/release/wxshare-1.0.1.js",function(){t=t||"",e=e||"",i=i||"//simg1.qunarzz.com/piao/images/touch/app_logo100.png",o=o||window.location.href,$.util.WxShare(t,e,i,o)});else if("app"==this.runOn){var r={title:t,link:o,desc:e,imgUrl:i,success:n||function(){},fail:a||function(){}};QunarAPI.ready(function(){QunarAPI.onMenuShare(r)})}},ptouch.page.Util.triggerShare=function(t){"app"==t&&QunarAPI.ready(function(){QunarAPI.hy.showShareItems({})})},ptouch.page.Util.getDeviceInfo=function(t,e){QunarAPI.ready(function(){QunarAPI.hy.getDeviceInfo({success:function(i){"function"==typeof t&&t(i,e)}})})},$.provide("ptouch.page.View"),ptouch.page.View=function(t){this.element=null,this.runOn=t,this.userAgent=navigator.userAgent.toLowerCase()},ptouch.page.View.prototype.useAppHeader=!0,ptouch.page.View.prototype.init=function(t){if(!t instanceof $.zepto.Z&&(t=$(t)),this.setElement(t),this.header=t.find(".mp-header"),this.contentWrap=t.find(".mp-main"),this.headerLeft=this.header.role("left"),this.headerTitle=this.header.role("title"),this.headerRight=this.header.role("right"),"app"==this.runOn&&this.header.length&&(this.isIPhone()&&!this.useAppHeader&&(this.header.css("padding-top","20px"),this.headerLeft.css("top","20px"),this.headerRight.css("top","20px")),this.useAppHeader&&this.header.addClass("mp-header-inapp")),"app"==this.runOn&&this.contentWrap.length){var e=this.isIPhone()?"mp-content-iniphone":"mp-content-inaphone";this.contentWrap.addClass(e)}this.bindEvents()},ptouch.page.View.prototype.render=function(t){var e=$('<div class="mp-page" id="main-page"><div class="mp-header" style="display:none;"><a class="mp-header-left mpg-iconfont" mp-role="left">&#xf3cd;</a><h1 class="mp-header-title" mp-role="title"></h1><span class="mp-header-right" mp-role="right"></span></div><div class="mp-main" id="mp-main"></div></div>');e.appendTo(t),this.init(e)},ptouch.page.View.prototype.decorate=function(t){this.init(t)},ptouch.page.View.prototype.isIPhone=function(){return this.userAgent.indexOf("iphone")>-1},ptouch.page.View.prototype.isAndroid=function(){return this.userAgent.indexOf("android")>-1},ptouch.page.View.prototype.bindEvents=function(){$(document.body).listen("touchstart",function(){},this),"app"==this.runOn&&this.element.delegate("a[hybrid-link]","click",$.proxy(this.handleLinkClick,this)),this.useAppHeader&&this.bindNativeHeaderClick({success:$.proxy(this.handleHeaderClick,this)}),this.bindDomHeaderClick(),FastClick.attach(document.body)},ptouch.page.View.prototype.bindDomHeaderClick=function(){this.headerLeft.length>0&&this.headerLeft.listen("click",this.handleHeaderClick,this),this.headerTitle.length>0&&this.headerTitle.listen("click",this.handleHeaderClick,this),this.headerRight.length>0&&this.headerRight.listen("click",this.handleHeaderClick,this)},ptouch.page.View.prototype.setUseAppHeader=function(t){this.useAppHeader=t},ptouch.page.View.prototype.handleHeaderClick=function(t){var e="app"==this.runOn&&t.button&&!t.currentTarget,i=e?t.button:$(t.currentTarget),o=e?t.button:i.attr("mp-role"),n=e?"native":"dom",a=null;switch(o){case"left":a=new $.Event("headerleftclick",{element:i,srcType:n}),$(this).triggerHandler(a),a.isDefaultPrevented()||this.useAppHeader&&"app"==this.runOn||ptouch.page.Util.closeWebView({},this.runOn);break;case"title":a=new $.Event("headertitleclick",{element:i,srcType:n}),$(this).triggerHandler(a);break;case"right":a=new $.Event("headerrightclick",{element:i,srcType:n}),$(this).triggerHandler(a)}if(a&&a.isDefaultPrevented())return!1},ptouch.page.View.prototype.bindNativeHeaderClick=function(t){QunarAPI.ready(function(){QunarAPI.hy.onNavClick(t)})},ptouch.page.View.prototype.setElement=function(t){this.element=t},ptouch.page.View.prototype.enableScrollHeader=function(){this.scrollHeader=!0,this.header.css({position:"fixed",width:"100%",top:0,left:0}),this.setHeaderVisible(!1),this.createBackElement(),$(window).listen("scroll",this.handleHeaderScroll,this)},ptouch.page.View.prototype.handleBackElementClick=function(){ptouch.page.Util.closeWebView({},this.runOn)},ptouch.page.View.prototype.disableScrollHeader=function(){this.scrollHeader=!1,this.header.css("position","relative"),this.setHeaderVisible(!0),this.removeBackElement(),$(window).unlisten("scroll",this.handleHeaderScroll,this)},ptouch.page.View.prototype.createBackElement=function(){var t=$('<a class="mp-header-back mpg-iconfont"><span class="mp-headerback-bg"></span><span class="mp-headerback-icon">&#xe904;</span></a>');t.appendTo(this.element),this.isIPhone()&&"app"==this.runOn&&t.css("top","20px"),this.backElement=t,this.backElement.listen("click",this.handleBackElementClick,this)},ptouch.page.View.prototype.removeBackElement=function(){this.backElement.unlisten("click",this.handleBackElementClick,this),this.backElement.remove()},ptouch.page.View.prototype.handleHeaderScroll=function(){var t=$(window).scrollTop();if(t<=180){this.backElement&&this.backElement.hide();var e=t/180;this.header.css({display:"block",opacity:e}),0==t&&(this.header.hide(),this.backElement&&this.backElement.show())}else this.header.css({display:"block",opacity:1})},ptouch.page.View.prototype.setContent=function(t){this.contentWrap.html(t)},ptouch.page.View.prototype.setHeader=function(t,e,i){t&&("object"==typeof t?this.headerTitle.html(t.html):"string"==typeof t&&this.headerTitle.html(t)),e&&("object"==typeof e?this.headerLeft.html(e.html):"string"==typeof e&&this.headerLeft.html(e)),i&&("object"==typeof i?this.headerRight.html(i.html):"string"==typeof i&&this.headerRight.html(i)),this.setHeaderVisible(!0)},ptouch.page.View.prototype.getElement=function(){return this.element},ptouch.page.View.prototype.getHeader=function(){return this.header},ptouch.page.View.prototype.getContent=function(){return this.contentWrap},ptouch.page.View.prototype.setHeaderVisible=function(t){t?this.header.show():this.header.hide()},ptouch.page.View.prototype.handleLinkClick=function(t){t.preventDefault();var e=t.currentTarget.href,i=t.currentTarget.title,o=$(t.currentTarget).attr("hy-header"),n=i&&"false"!=o?"navibar-normal":"navibar-none";return ptouch.page.Util.openWebView({url:e,animate:"moveFromRight",type:n,onViewBack:$.proxy(this.handleViewBack,this),navigation:{title:{style:"text",text:i}}},this.runOn),!1},ptouch.page.View.prototype.handleViewBack=function(t){$(this).triggerHandler("viewback",[t])},$.provide("ptouch.Page"),ptouch.Page=function(t){this.context=t||{},this.setRunOn(),ptouch.Page.runOn=this.runOn,this.view=new ptouch.page.View(this.runOn),this.dot=new ptouch.page.Dot(this.context)},ptouch.Page.prototype.setRunOn=function(){var t=navigator.userAgent.toLocaleLowerCase();if(t.indexOf("micromessenger")>-1)this.runOn="weixin";else if(this.context.scheme)this.context.scheme.indexOf("qunariphone")>-1||this.context.scheme.indexOf("qunaraphone")>-1?this.runOn="app":this.runOn="touch";else{var e=t.match(/(qunar[a-z]+)\/(\d+)/);e&&e.length?this.runOn="app":this.runOn="touch"}},ptouch.Page.prototype.init=function(t){try{"app"==this.runOn&&(this.handleScriptTemplate(),t instanceof $.zepto.Z&&(t=t.selector)),(t=$(t)).length?this.view.decorate(t):this.view.render(document.body),this.preventInject(),this.autoDispatchBeacon(),"app"==this.runOn?$.listen(window,"load",function(){setTimeout($.proxy(this.init_,this),0)},this):this.init_(),this.dot.dispatchTimeConsume()}catch(t){throw this.dot.dispatchException(t),t}},ptouch.Page.prototype.handleScriptTemplate=function(){var t=$('script[type="text/html"]');t.length&&t.each(function(e){var i=t.eq(e);$(i.html()).insertBefore(i),i.remove()})},ptouch.Page.prototype.autoDispatchBeacon=function(){this.dot.dispatchBeacon()},ptouch.Page.prototype.preventInject=function(){"https:"!=location.protocol&&(ptouch.page.Util.handleInject(document.head),ptouch.page.Util.handleInject(document.body))},ptouch.Page.prototype.bindShare=function(t,e,i,o,n,a){ptouch.page.Util.bindShare.apply(this,arguments)},ptouch.Page.prototype.triggerShare=function(){ptouch.page.Util.triggerShare(this.runOn)},ptouch.Page.prototype.setHeader=function(t,e,i,o,n){if(e||n||"weixin"==this.runOn||"touch"==this.runOn)this.view.setHeader(t,o,i),e&&(this.view.enableScrollHeader(),this.view.setUseAppHeader(!1));else if("app"==this.runOn){var a={};t&&("object"==typeof t?(t.text&&(document.title=t.text),a.title=t):"string"==typeof t&&(document.title=t,a.title={text:t,style:"text"})),o&&("object"==typeof o?a.left=o:"string"==typeof t&&(a.left={text:o,style:"text"})),i&&("object"==typeof i?a.right=i:"string"==typeof t&&(a.right={text:i,style:"text"})),QunarAPI.ready(function(){QunarAPI.hy.navRefresh(a)}),this.view.setUseAppHeader(!0)}},ptouch.Page.prototype.setContent=function(t){this.view.setContent(t),this.dot.handlePageReady()},ptouch.Page.prototype.getView=function(){return this.view},ptouch.Page.prototype.openWebView=function(t){ptouch.page.Util.openWebView(t,this.runOn)},ptouch.Page.prototype.closeWebView=function(t){ptouch.page.Util.closeWebView(t,this.runOn)},ptouch.Page.prototype.navRefresh=function(t){ptouch.page.Util.navRefresh(t)},ptouch.Page.prototype.getInitData=function(t){"app"==this.runOn?QunarAPI.ready(function(){QunarAPI.hy.getInitData({success:function(e){t(e)},fail:function(){t()}})}):t()},ptouch.Page.prototype.updateAndroidVersionInfo=function(t){$.os.android&&(t&&QunarAPI.ready(function(){QunarAPI.onLoadingClose({success:function(t,e){e({data:!0})}})}),ptouch.page.Util.getDeviceInfo(this.updateVersionCookie,{needReload:t}))},ptouch.Page.prototype.updateVersionCookie=function(t,e){var i=t.atomversion||{},o=i.sight,n=!1;if(e&&e.needReload&&(n=!0),i&&o){var a=$.cookie("QN278"),r=JSON.parse(decodeURIComponent(a||"{}"));if(a&&r.sight==o)QunarAPI.hideLoadView({});else{var s={sight:o};$.cookie("QN278",JSON.stringify(s),{expires:365,path:"/"}),n&&window.location.reload()}}else QunarAPI.hideLoadView({})},$.provide("ptouch.Purchase"),ptouch.Purchase=function(t){window.context.isShowUnPayOrderAlarm&&"true"==window.context.isShowUnPayOrderAlarm&&this.getOrderNum()},ptouch.Purchase.prototype={createDom:function(){this.entity=$('<a id="purchase-btn" class="mp-purchase" href="#"><div class="purchase-icon"></div></a>'),this.mainPageElem=$("#main-page")?$("#main-page"):$(document.body),this.mainPageElem.append(this.entity),this.entity.css({transform:"translate(-10px, -10px) translateZ(0px);"})},createNotPayNum:function(){0!=this.data.notPayOrderSize&&this.entity.append($('<div class="nopay">'+(this.data.notPayOrderSize>99?"...":this.data.notPayOrderSize)+"</div>")),this.entity.attr("href","/touch/order/list.htm")},getOrderNum:function(){$.ajax({url:"/touch/order/queryNotPayOrderSize.json",type:"get",dataType:"json",cache:!1,context:this,success:this.handleGetNumSuccess})},handleGetNumSuccess:function(t){t.ret&&t.data&&t.data.notPayOrderSize&&(this.data=t.data,this.createDom(),this.createNotPayNum())}},$.provide("$.IScroll"),function(t,e){function i(t){return""===a?t:(t=t.charAt(0).toUpperCase()+t.substr(1),a+t)}var o=Math,n=e.createElement("div").style,a=function(){for(var t="t,webkitT,MozT,msT,OT".split(","),e=0,i=t.length;e<i;e++)if(t[e]+"ransform"in n)return t[e].substr(0,t[e].length-1);return!1}(),r=a?"-"+a.toLowerCase()+"-":"",s=i("transform"),c=i("transitionProperty"),l=i("transitionDuration"),p=i("transformOrigin"),h=i("transitionTimingFunction"),d=i("transitionDelay"),u=/android/gi.test(navigator.appVersion),m=/iphone|ipad/gi.test(navigator.appVersion),f=/hp-tablet/gi.test(navigator.appVersion),g=i("perspective")in n,b="ontouchstart"in t&&!f,y=!1!==a,v=i("transition")in n,w="onorientationchange"in t?"orientationchange":"resize",k=b?"touchstart":"mousedown",S=b?"touchmove":"mousemove",x=b?"touchend":"mouseup",T=b?"touchcancel":"mouseup",C=!1!==a&&{"":"transitionend",webkit:"webkitTransitionEnd",Moz:"transitionend",O:"otransitionend",ms:"MSTransitionEnd"}[a],P=t.requestAnimationFrame||t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||t.oRequestAnimationFrame||t.msRequestAnimationFrame||function(t){return setTimeout(t,1)},D=t.cancelRequestAnimationFrame||t.webkitCancelAnimationFrame||t.webkitCancelRequestAnimationFrame||t.mozCancelRequestAnimationFrame||t.oCancelRequestAnimationFrame||t.msCancelRequestAnimationFrame||clearTimeout,I=g?" translateZ(0)":"",_=function(i,o){var n,a=this;a.wrapper="object"==typeof i?i:e.getElementById(i),a.wrapper.style.overflow="hidden",a.scroller=a.wrapper.children[0],a.options={hScroll:!0,vScroll:!0,x:0,y:0,bounce:!0,bounceLock:!1,momentum:!0,lockDirection:!0,useTransform:!0,useTransition:!1,topOffset:0,checkDOMChanges:!1,handleClick:!0,hScrollbar:!0,vScrollbar:!0,fixedScrollbar:u,hideScrollbar:m,fadeScrollbar:m&&g,scrollbarClass:"",zoom:!1,zoomMin:1,zoomMax:4,doubleTapZoom:2,wheelAction:"scroll",snap:!1,snapThreshold:1,onRefresh:null,onBeforeScrollStart:function(t){for(var e=t.target;1!=e.nodeType;)e=e.parentNode;"SELECT"!=e.tagName&&"INPUT"!=e.tagName&&"TEXTAREA"!=e.tagName&&t.preventDefault()},onScrollStart:null,onBeforeScrollMove:null,onScrollMove:null,onBeforeScrollEnd:null,onScrollEnd:null,onTouchEnd:null,onDestroy:null,onZoomStart:null,onZoom:null,onZoomEnd:null};for(n in o)a.options[n]=o[n];a.x=a.options.x,a.y=a.options.y,a.options.useTransform=y&&a.options.useTransform,a.options.hScrollbar=a.options.hScroll&&a.options.hScrollbar,a.options.vScrollbar=a.options.vScroll&&a.options.vScrollbar,a.options.zoom=a.options.useTransform&&a.options.zoom,a.options.useTransition=v&&a.options.useTransition,a.options.zoom&&u&&(I=""),a.scroller.style[c]=a.options.useTransform?r+"transform":"top left",a.scroller.style[l]="0",a.scroller.style[p]="0 0",a.options.useTransition&&(a.scroller.style[h]="cubic-bezier(0.33,0.66,0.66,1)"),a.options.useTransform?a.scroller.style[s]="translate("+a.x+"px,"+a.y+"px)"+I:a.scroller.style.cssText+=";position:absolute;top:"+a.y+"px;left:"+a.x+"px",a.options.useTransition&&(a.options.fixedScrollbar=!0),a.refresh(),a._bind(w,t),a._bind(k),b||"none"!=a.options.wheelAction&&(a._bind("DOMMouseScroll"),a._bind("mousewheel")),a.options.checkDOMChanges&&(a.checkDOMTime=setInterval(function(){a._checkDOMChanges()},500))};_.prototype={enabled:!0,x:0,y:0,steps:[],scale:1,currPageX:0,currPageY:0,pagesX:[],pagesY:[],aniTime:null,wheelZoomCount:0,handleEvent:function(t){var e=this;switch(t.type){case k:if(!b&&0!==t.button)return;e._start(t);break;case S:e._move(t);break;case x:case T:e._end(t);break;case w:e._resize();break;case"DOMMouseScroll":case"mousewheel":e._wheel(t);break;case C:e._transitionEnd(t)}},_checkDOMChanges:function(){this.moved||this.zoomed||this.animating||this.scrollerW==this.scroller.offsetWidth*this.scale&&this.scrollerH==this.scroller.offsetHeight*this.scale||this.refresh()},_scrollbar:function(t){var i,n=this;n[t+"Scrollbar"]?(n[t+"ScrollbarWrapper"]||(i=e.createElement("div"),n.options.scrollbarClass?i.className=n.options.scrollbarClass+t.toUpperCase():i.style.cssText="position:absolute;z-index:100;"+("h"==t?"height:7px;bottom:1px;left:2px;right:"+(n.vScrollbar?"7":"2")+"px":"width:7px;bottom:"+(n.hScrollbar?"7":"2")+"px;top:2px;right:1px"),i.style.cssText+=";pointer-events:none;"+r+"transition-property:opacity;"+r+"transition-duration:"+(n.options.fadeScrollbar?"350ms":"0")+";overflow:hidden;opacity:"+(n.options.hideScrollbar?"0":"1"),n.wrapper.appendChild(i),n[t+"ScrollbarWrapper"]=i,i=e.createElement("div"),n.options.scrollbarClass||(i.style.cssText="position:absolute;z-index:100;background:rgba(0,0,0,0.5);border:1px solid rgba(255,255,255,0.9);"+r+"background-clip:padding-box;"+r+"box-sizing:border-box;"+("h"==t?"height:100%":"width:100%")+";"+r+"border-radius:3px;border-radius:3px"),i.style.cssText+=";pointer-events:none;"+r+"transition-property:"+r+"transform;"+r+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1);"+r+"transition-duration:0;"+r+"transform: translate(0,0)"+I,n.options.useTransition&&(i.style.cssText+=";"+r+"transition-timing-function:cubic-bezier(0.33,0.66,0.66,1)"),n[t+"ScrollbarWrapper"].appendChild(i),n[t+"ScrollbarIndicator"]=i),"h"==t?(n.hScrollbarSize=n.hScrollbarWrapper.clientWidth,n.hScrollbarIndicatorSize=o.max(o.round(n.hScrollbarSize*n.hScrollbarSize/n.scrollerW),8),n.hScrollbarIndicator.style.width=n.hScrollbarIndicatorSize+"px",n.hScrollbarMaxScroll=n.hScrollbarSize-n.hScrollbarIndicatorSize,n.hScrollbarProp=n.hScrollbarMaxScroll/n.maxScrollX):(n.vScrollbarSize=n.vScrollbarWrapper.clientHeight,n.vScrollbarIndicatorSize=o.max(o.round(n.vScrollbarSize*n.vScrollbarSize/n.scrollerH),8),n.vScrollbarIndicator.style.height=n.vScrollbarIndicatorSize+"px",n.vScrollbarMaxScroll=n.vScrollbarSize-n.vScrollbarIndicatorSize,n.vScrollbarProp=n.vScrollbarMaxScroll/n.maxScrollY),n._scrollbarPos(t,!0)):n[t+"ScrollbarWrapper"]&&(y&&(n[t+"ScrollbarIndicator"].style[s]=""),n[t+"ScrollbarWrapper"].parentNode.removeChild(n[t+"ScrollbarWrapper"]),n[t+"ScrollbarWrapper"]=null,n[t+"ScrollbarIndicator"]=null)},_resize:function(){var t=this;setTimeout(function(){t.refresh()},u?200:0)},_pos:function(t,e){this.zoomed||(t=this.hScroll?t:0,e=this.vScroll?e:0,this.options.useTransform?this.scroller.style[s]="translate("+t+"px,"+e+"px) scale("+this.scale+")"+I:(t=o.round(t),e=o.round(e),this.scroller.style.left=t+"px",this.scroller.style.top=e+"px"),this.x=t,this.y=e,this._scrollbarPos("h"),this._scrollbarPos("v"))},_scrollbarPos:function(t,e){var i,n=this,a="h"==t?n.x:n.y;n[t+"Scrollbar"]&&((a=n[t+"ScrollbarProp"]*a)<0?(n.options.fixedScrollbar||((i=n[t+"ScrollbarIndicatorSize"]+o.round(3*a))<8&&(i=8),n[t+"ScrollbarIndicator"].style["h"==t?"width":"height"]=i+"px"),a=0):a>n[t+"ScrollbarMaxScroll"]&&(n.options.fixedScrollbar?a=n[t+"ScrollbarMaxScroll"]:((i=n[t+"ScrollbarIndicatorSize"]-o.round(3*(a-n[t+"ScrollbarMaxScroll"])))<8&&(i=8),n[t+"ScrollbarIndicator"].style["h"==t?"width":"height"]=i+"px",a=n[t+"ScrollbarMaxScroll"]+(n[t+"ScrollbarIndicatorSize"]-i))),n[t+"ScrollbarWrapper"].style[d]="0",n[t+"ScrollbarWrapper"].style.opacity=e&&n.options.hideScrollbar?"0":"1",n[t+"ScrollbarIndicator"].style[s]="translate("+("h"==t?a+"px,0)":"0,"+a+"px)")+I)},_start:function(e){var i,n,a,r,c,l=this,p=b?e.touches[0]:e;l.enabled&&(l.options.onBeforeScrollStart&&l.options.onBeforeScrollStart.call(l,e),(l.options.useTransition||l.options.zoom)&&l._transitionTime(0),l.moved=!1,l.animating=!1,l.zoomed=!1,l.distX=0,l.distY=0,l.absDistX=0,l.absDistY=0,l.dirX=0,l.dirY=0,l.options.zoom&&b&&e.touches.length>1&&(r=o.abs(e.touches[0].pageX-e.touches[1].pageX),c=o.abs(e.touches[0].pageY-e.touches[1].pageY),l.touchesDistStart=o.sqrt(r*r+c*c),l.originX=o.abs(e.touches[0].pageX+e.touches[1].pageX-2*l.wrapperOffsetLeft)/2-l.x,l.originY=o.abs(e.touches[0].pageY+e.touches[1].pageY-2*l.wrapperOffsetTop)/2-l.y,l.options.onZoomStart&&l.options.onZoomStart.call(l,e)),l.options.momentum&&(l.options.useTransform?(n=+((i=getComputedStyle(l.scroller,null)[s].replace(/[^0-9\-.,]/g,"").split(","))[12]||i[4]),a=+(i[13]||i[5])):(n=+getComputedStyle(l.scroller,null).left.replace(/[^0-9-]/g,""),a=+getComputedStyle(l.scroller,null).top.replace(/[^0-9-]/g,"")),n==l.x&&a==l.y||(l.options.useTransition?l._unbind(C):D(l.aniTime),l.steps=[],l._pos(n,a),l.options.onScrollEnd&&l.options.onScrollEnd.call(l))),l.absStartX=l.x,l.absStartY=l.y,l.startX=l.x,l.startY=l.y,l.pointX=p.pageX,l.pointY=p.pageY,l.startTime=e.timeStamp||Date.now(),l.options.onScrollStart&&l.options.onScrollStart.call(l,e),l._bind(S,t),l._bind(x,t),l._bind(T,t))},_move:function(t){var e,i,n,a=this,r=b?t.touches[0]:t,c=r.pageX-a.pointX,l=r.pageY-a.pointY,p=a.x+c,h=a.y+l,d=t.timeStamp||Date.now();if(a.options.onBeforeScrollMove&&a.options.onBeforeScrollMove.call(a,t),a.options.zoom&&b&&t.touches.length>1)return e=o.abs(t.touches[0].pageX-t.touches[1].pageX),i=o.abs(t.touches[0].pageY-t.touches[1].pageY),a.touchesDist=o.sqrt(e*e+i*i),a.zoomed=!0,(n=1/a.touchesDistStart*a.touchesDist*this.scale)<a.options.zoomMin?n=.5*a.options.zoomMin*Math.pow(2,n/a.options.zoomMin):n>a.options.zoomMax&&(n=2*a.options.zoomMax*Math.pow(.5,a.options.zoomMax/n)),a.lastScale=n/this.scale,p=this.originX-this.originX*a.lastScale+this.x,h=this.originY-this.originY*a.lastScale+this.y,this.scroller.style[s]="translate("+p+"px,"+h+"px) scale("+n+")"+I,void(a.options.onZoom&&a.options.onZoom.call(a,t));a.pointX=r.pageX,a.pointY=r.pageY,(p>0||p<a.maxScrollX)&&(p=a.options.bounce?a.x+c/2:p>=0||a.maxScrollX>=0?0:a.maxScrollX),(h>a.minScrollY||h<a.maxScrollY)&&(h=a.options.bounce?a.y+l/2:h>=a.minScrollY||a.maxScrollY>=0?a.minScrollY:a.maxScrollY),a.distX+=c,a.distY+=l,a.absDistX=o.abs(a.distX),a.absDistY=o.abs(a.distY),a.absDistX<6&&a.absDistY<6||(a.options.lockDirection&&(a.absDistX>a.absDistY+5?(h=a.y,l=0):a.absDistY>a.absDistX+5&&(p=a.x,c=0)),a.moved=!0,a._pos(p,h),a.dirX=c>0?-1:c<0?1:0,a.dirY=l>0?-1:l<0?1:0,d-a.startTime>300&&(a.startTime=d,a.startX=a.x,a.startY=a.y),a.options.onScrollMove&&a.options.onScrollMove.call(a,t))},_end:function(i){if(!b||0===i.touches.length){var n,a,r,c,p,h,d,u=this,m=b?i.changedTouches[0]:i,f={dist:0,time:0},g={dist:0,time:0},y=(i.timeStamp||Date.now())-u.startTime,v=u.x,w=u.y;if(u._unbind(S,t),u._unbind(x,t),u._unbind(T,t),u.options.onBeforeScrollEnd&&u.options.onBeforeScrollEnd.call(u,i),u.zoomed)return d=u.scale*u.lastScale,d=Math.max(u.options.zoomMin,d),d=Math.min(u.options.zoomMax,d),u.lastScale=d/u.scale,u.scale=d,u.x=u.originX-u.originX*u.lastScale+u.x,u.y=u.originY-u.originY*u.lastScale+u.y,u.scroller.style[l]="200ms",u.scroller.style[s]="translate("+u.x+"px,"+u.y+"px) scale("+u.scale+")"+I,u.zoomed=!1,u.refresh(),void(u.options.onZoomEnd&&u.options.onZoomEnd.call(u,i));if(!u.moved)return b&&(u.doubleTapTimer&&u.options.zoom?(clearTimeout(u.doubleTapTimer),u.doubleTapTimer=null,u.options.onZoomStart&&u.options.onZoomStart.call(u,i),u.zoom(u.pointX,u.pointY,1==u.scale?u.options.doubleTapZoom:1),u.options.onZoomEnd&&setTimeout(function(){u.options.onZoomEnd.call(u,i)},200)):this.options.handleClick&&(u.doubleTapTimer=setTimeout(function(){for(u.doubleTapTimer=null,n=m.target;1!=n.nodeType;)n=n.parentNode;"SELECT"!=n.tagName&&"INPUT"!=n.tagName&&"TEXTAREA"!=n.tagName&&((a=e.createEvent("MouseEvents")).initMouseEvent("click",!0,!0,i.view,1,m.screenX,m.screenY,m.clientX,m.clientY,i.ctrlKey,i.altKey,i.shiftKey,i.metaKey,0,null),a._fake=!0,n.dispatchEvent(a))},u.options.zoom?250:0))),u._resetPos(400),void(u.options.onTouchEnd&&u.options.onTouchEnd.call(u,i));if(y<300&&u.options.momentum&&(f=v?u._momentum(v-u.startX,y,-u.x,u.scrollerW-u.wrapperW+u.x,u.options.bounce?u.wrapperW:0):f,g=w?u._momentum(w-u.startY,y,-u.y,u.maxScrollY<0?u.scrollerH-u.wrapperH+u.y-u.minScrollY:0,u.options.bounce?u.wrapperH:0):g,v=u.x+f.dist,w=u.y+g.dist,(u.x>0&&v>0||u.x<u.maxScrollX&&v<u.maxScrollX)&&(f={dist:0,time:0}),(u.y>u.minScrollY&&w>u.minScrollY||u.y<u.maxScrollY&&w<u.maxScrollY)&&(g={dist:0,time:0})),f.dist||g.dist)return p=o.max(o.max(f.time,g.time),10),u.options.snap&&(r=v-u.absStartX,c=w-u.absStartY,o.abs(r)<u.options.snapThreshold&&o.abs(c)<u.options.snapThreshold?u.scrollTo(u.absStartX,u.absStartY,200):(v=(h=u._snap(v,w)).x,w=h.y,p=o.max(h.time,p))),u.scrollTo(o.round(v),o.round(w),p),void(u.options.onTouchEnd&&u.options.onTouchEnd.call(u,i));if(u.options.snap)return r=v-u.absStartX,c=w-u.absStartY,o.abs(r)<u.options.snapThreshold&&o.abs(c)<u.options.snapThreshold?u.scrollTo(u.absStartX,u.absStartY,200):(h=u._snap(u.x,u.y)).x==u.x&&h.y==u.y||u.scrollTo(h.x,h.y,h.time),void(u.options.onTouchEnd&&u.options.onTouchEnd.call(u,i));u._resetPos(200),u.options.onTouchEnd&&u.options.onTouchEnd.call(u,i)}},_resetPos:function(t){var e=this,i=e.x>=0?0:e.x<e.maxScrollX?e.maxScrollX:e.x,o=e.y>=e.minScrollY||e.maxScrollY>0?e.minScrollY:e.y<e.maxScrollY?e.maxScrollY:e.y;if(i==e.x&&o==e.y)return e.moved&&(e.moved=!1,e.options.onScrollEnd&&e.options.onScrollEnd.call(e)),e.hScrollbar&&e.options.hideScrollbar&&("webkit"==a&&(e.hScrollbarWrapper.style[d]="300ms"),e.hScrollbarWrapper.style.opacity="0"),void(e.vScrollbar&&e.options.hideScrollbar&&("webkit"==a&&(e.vScrollbarWrapper.style[d]="300ms"),e.vScrollbarWrapper.style.opacity="0"));e.scrollTo(i,o,t||0)},_wheel:function(t){var e,i,o,n,a,r=this;if("wheelDeltaX"in t)0==r.vScroll&&1==r.hScroll?(i=t.wheelDeltaX/.5,e=t.wheelDeltaY/.5):(e=t.wheelDeltaX/.5,i=t.wheelDeltaY/.5);else if("wheelDelta"in t)e=i=t.wheelDelta/12;else{if(!("detail"in t))return;e=i=3*-t.detail}if("zoom"==r.options.wheelAction)return(a=r.scale*Math.pow(2,1/3*(i?i/Math.abs(i):0)))<r.options.zoomMin&&(a=r.options.zoomMin),a>r.options.zoomMax&&(a=r.options.zoomMax),void(a!=r.scale&&(!r.wheelZoomCount&&r.options.onZoomStart&&r.options.onZoomStart.call(r,t),r.wheelZoomCount++,r.zoom(t.pageX,t.pageY,a,400),setTimeout(function(){r.wheelZoomCount--,!r.wheelZoomCount&&r.options.onZoomEnd&&r.options.onZoomEnd.call(r,t)},400)));o=r.x+e,n=r.y+i,o>0?o=0:o<r.maxScrollX&&(o=r.maxScrollX),n>r.minScrollY?n=r.minScrollY:n<r.maxScrollY&&(n=r.maxScrollY),(r.maxScrollY<0||r.maxScrollX<0)&&r.scrollTo(o,n,500)},_transitionEnd:function(t){var e=this;t.target==e.scroller&&(e._unbind(C),e._startAni())},_startAni:function(){var t,e,i,n=this,a=n.x,r=n.y,s=Date.now();if(!n.animating)if(n.steps.length){if((t=n.steps.shift()).x==a&&t.y==r&&(t.time=0),n.animating=!0,n.moved=!0,n.options.useTransition)return n._transitionTime(t.time),n._pos(t.x,t.y),n.animating=!1,void(t.time?n._bind(C):n._resetPos(0));(i=function(){var c,l,p=Date.now();if(p>=s+t.time)return n._pos(t.x,t.y),n.animating=!1,n.options.onAnimationEnd&&n.options.onAnimationEnd.call(n),void n._startAni();p=(p-s)/t.time-1,e=o.sqrt(1-p*p),c=(t.x-a)*e+a,l=(t.y-r)*e+r,n._pos(c,l),n.animating&&(n.aniTime=P(i))})()}else n._resetPos(400)},_transitionTime:function(t){t+="ms",this.scroller.style[l]=t,this.hScrollbar&&(this.hScrollbarIndicator.style[l]=t),this.vScrollbar&&(this.vScrollbarIndicator.style[l]=t)},_momentum:function(t,e,i,n,a){var r=o.abs(t)/e,s=r*r/.0012,c=0;return t>0&&s>i?(r=r*(i+=a/(6/(s/r*6e-4)))/s,s=i):t<0&&s>n&&(r=r*(n+=a/(6/(s/r*6e-4)))/s,s=n),s*=t<0?-1:1,c=r/6e-4,{dist:s,time:o.round(c)}},_offset:function(t){for(var e=-t.offsetLeft,i=-t.offsetTop;t=t.offsetParent;)e-=t.offsetLeft,i-=t.offsetTop;return t!=this.wrapper&&(e*=this.scale,i*=this.scale),{left:e,top:i}},_snap:function(t,e){var i,n,a,r,s,c,l=this;for(a=l.pagesX.length-1,i=0,n=l.pagesX.length;i<n;i++)if(t>=l.pagesX[i]){a=i;break}for(a==l.currPageX&&a>0&&l.dirX<0&&a--,t=l.pagesX[a],s=(s=o.abs(t-l.pagesX[l.currPageX]))?o.abs(l.x-t)/s*500:0,l.currPageX=a,a=l.pagesY.length-1,i=0;i<a;i++)if(e>=l.pagesY[i]){a=i;break}return a==l.currPageY&&a>0&&l.dirY<0&&a--,e=l.pagesY[a],c=o.abs(e-l.pagesY[l.currPageY]),c=c?o.abs(l.y-e)/c*500:0,l.currPageY=a,r=o.round(o.max(s,c))||200,{x:t,y:e,time:r}},_bind:function(t,e,i){(e||this.scroller).addEventListener(t,this,!!i)},_unbind:function(t,e,i){(e||this.scroller).removeEventListener(t,this,!!i)},destroy:function(){var e=this;e.scroller.style[s]="",e.hScrollbar=!1,e.vScrollbar=!1,e._scrollbar("h"),e._scrollbar("v"),e._unbind(w,t),e._unbind(k),e._unbind(S,t),e._unbind(x,t),e._unbind(T,t),e.options.hasTouch||(e._unbind("DOMMouseScroll"),e._unbind("mousewheel")),e.options.useTransition&&e._unbind(C),e.options.checkDOMChanges&&clearInterval(e.checkDOMTime),e.options.onDestroy&&e.options.onDestroy.call(e)},refresh:function(){var t,e,i,n,a=this,r=0,s=0;if(a.scale<a.options.zoomMin&&(a.scale=a.options.zoomMin),a.wrapperW=a.wrapper.clientWidth||1,a.wrapperH=a.wrapper.clientHeight||1,a.minScrollY=-a.options.topOffset||0,a.scrollerW=o.round(a.scroller.offsetWidth*a.scale),a.scrollerH=o.round((a.scroller.offsetHeight+a.minScrollY)*a.scale),a.maxScrollX=a.wrapperW-a.scrollerW,a.maxScrollY=a.wrapperH-a.scrollerH+a.minScrollY,a.dirX=0,a.dirY=0,a.options.onRefresh&&a.options.onRefresh.call(a),a.hScroll=a.options.hScroll&&a.maxScrollX<0,a.vScroll=a.options.vScroll&&(!a.options.bounceLock&&!a.hScroll||a.scrollerH>a.wrapperH),a.hScrollbar=a.hScroll&&a.options.hScrollbar,a.vScrollbar=a.vScroll&&a.options.vScrollbar&&a.scrollerH>a.wrapperH,t=a._offset(a.wrapper),a.wrapperOffsetLeft=-t.left,a.wrapperOffsetTop=-t.top,"string"==typeof a.options.snap)for(a.pagesX=[],a.pagesY=[],e=0,i=(n=a.scroller.querySelectorAll(a.options.snap)).length;e<i;e++)(r=a._offset(n[e])).left+=a.wrapperOffsetLeft,r.top+=a.wrapperOffsetTop,a.pagesX[e]=r.left<a.maxScrollX?a.maxScrollX:r.left*a.scale,a.pagesY[e]=r.top<a.maxScrollY?a.maxScrollY:r.top*a.scale;else if(a.options.snap){for(a.pagesX=[];r>=a.maxScrollX;)a.pagesX[s]=r,r-=a.wrapperW,s++;for(a.maxScrollX%a.wrapperW&&(a.pagesX[a.pagesX.length]=a.maxScrollX-a.pagesX[a.pagesX.length-1]+a.pagesX[a.pagesX.length-1]),r=0,s=0,a.pagesY=[];r>=a.maxScrollY;)a.pagesY[s]=r,r-=a.wrapperH,s++;a.maxScrollY%a.wrapperH&&(a.pagesY[a.pagesY.length]=a.maxScrollY-a.pagesY[a.pagesY.length-1]+a.pagesY[a.pagesY.length-1])}a._scrollbar("h"),a._scrollbar("v"),a.zoomed||(a.scroller.style[l]="0",a._resetPos(400))},scrollTo:function(t,e,i,o){var n,a,r=this,s=t;for(r.stop(),s.length||(s=[{x:t,y:e,time:i,relative:o}]),n=0,a=s.length;n<a;n++)s[n].relative&&(s[n].x=r.x-s[n].x,s[n].y=r.y-s[n].y),r.steps.push({x:s[n].x,y:s[n].y,time:s[n].time||0});r._startAni()},scrollToElement:function(t,e){var i,n=this;(t=t.nodeType?t:n.scroller.querySelector(t))&&((i=n._offset(t)).left+=n.wrapperOffsetLeft,i.top+=n.wrapperOffsetTop,i.left=i.left>0?0:i.left<n.maxScrollX?n.maxScrollX:i.left,i.top=i.top>n.minScrollY?n.minScrollY:i.top<n.maxScrollY?n.maxScrollY:i.top,e=void 0===e?o.max(2*o.abs(i.left),2*o.abs(i.top)):e,n.scrollTo(i.left,i.top,e))},scrollToPage:function(t,e,i){var o,n,a=this;i=void 0===i?400:i,a.options.onScrollStart&&a.options.onScrollStart.call(a),a.options.snap?(t="next"==t?a.currPageX+1:"prev"==t?a.currPageX-1:t,e="next"==e?a.currPageY+1:"prev"==e?a.currPageY-1:e,t=t<0?0:t>a.pagesX.length-1?a.pagesX.length-1:t,e=e<0?0:e>a.pagesY.length-1?a.pagesY.length-1:e,a.currPageX=t,a.currPageY=e,o=a.pagesX[t],n=a.pagesY[e]):(o=-a.wrapperW*t,n=-a.wrapperH*e,o<a.maxScrollX&&(o=a.maxScrollX),n<a.maxScrollY&&(n=a.maxScrollY)),a.scrollTo(o,n,i)},disable:function(){this.stop(),this._resetPos(0),this.enabled=!1,this._unbind(S,t),this._unbind(x,t),this._unbind(T,t)},enable:function(){this.enabled=!0},stop:function(){this.options.useTransition?this._unbind(C):D(this.aniTime),this.steps=[],this.moved=!1,this.animating=!1},zoom:function(t,e,i,o){var n=this,a=i/n.scale;n.options.useTransform&&(n.zoomed=!0,o=void 0===o?200:o,t=t-n.wrapperOffsetLeft-n.x,e=e-n.wrapperOffsetTop-n.y,n.x=t-t*a+n.x,n.y=e-e*a+n.y,n.scale=i,n.refresh(),n.x=n.x>0?0:n.x<n.maxScrollX?n.maxScrollX:n.x,n.y=n.y>n.minScrollY?n.minScrollY:n.y<n.maxScrollY?n.maxScrollY:n.y,n.scroller.style[l]=o+"ms",n.scroller.style[s]="translate("+n.x+"px,"+n.y+"px) scale("+i+")"+I,n.zoomed=!1)},isReady:function(){return!this.moved&&!this.zoomed&&!this.animating}},n=null,t.iScroll=_,$.IScroll=_}(window,document),$.provide("$.ui.Slider"),$.ui.Slider=function(){},$.ui.Slider.prototype.items=null,$.ui.Slider.prototype.index_=-1,$.ui.Slider.prototype.setItems=function(t){this.items_=t},$.ui.Slider.prototype.getItems=function(){return this.items_},$.ui.Slider.prototype.getItem=function(t){return this.items_[t]||null},$.ui.Slider.prototype.getItemCount=function(){return this.items_?this.items_.length:0},$.ui.Slider.prototype.setIndex=function(t){this.index_=t},$.ui.Slider.prototype.getIndex=function(){return this.index_},$.provide("ptouch.ui.PictureSlider"),ptouch.ui.PictureSlider=function(t){this.setItems(t)},$.inherits(ptouch.ui.PictureSlider,$.ui.Slider),ptouch.ui.PictureSlider.prototype.create=function(t){this.createDom(),this.bindEvents(),this.element.appendTo(t)},ptouch.ui.PictureSlider.prototype.createDom=function(){this.element=$("<div>").addClass("mp-imgswipe").html('<div class="mp-slide-closebutton"><span class="mpg-iconfont">&#xe612;</span></div><div class="mp-imgswipe-show js-slider-picture mp-imgswipe-current"></div><div class="mp-imgswipe-show js-slider-picture-back"></div><div class="mp-imgswipe-bar"><div class="mp-imgswipe-note"><em class="js-slider-name"></em><span class="js-slider-namesub"></span></div><div class="mp-imgswipe-turn mp-imgswipe-prev"><span class="mpg-iconfont">&#x46;</span></div><div class="mp-imgswipe-turn mp-imgswipe-next"><span class="mpg-iconfont">&#x46;</span></div></div>'),this.picContainer=this.element.find(".js-slider-picture"),this.backPicContainer=this.element.find(".js-slider-picture-back"),this.titleElem=this.element.find(".js-slider-name"),this.indexElem=this.element.find(".js-slider-namesub"),this.leftButton=this.element.find(".mp-imgswipe-prev"),this.rightButton=this.element.find(".mp-imgswipe-next"),this.touchContainer=this.element.find(".mp-imgswipe-current")},ptouch.ui.PictureSlider.prototype.bindEvents=function(){this.leftButton.listen("click",this.handleLeftButtonClick,this),this.rightButton.listen("click",this.handleRightButtonClick,this),this.picContainer.listen("click",this.handleCloseSlider,this),this.getItemCount()>1&&(this.touchContainer.listen("touchstart",this.handleTouchStart,this),this.touchContainer.listen("touchmove",this.handleTouchMove,this),this.touchContainer.listen("touchend",this.handleTouchEnd,this))},ptouch.ui.PictureSlider.prototype.getTouchPoint=function(t){return t.targetTouches[0]},ptouch.ui.PictureSlider.prototype.handleTouchStart=function(t){this.startX=this.getTouchPoint(t).screenX,this.showBack=!1,$.os&&$.os.ios&&t.preventDefault()},ptouch.ui.PictureSlider.prototype.handleTouchMove=function(t){var e=this.getTouchPoint(t).screenX,i=this.getItemCount(),o=e-this.startX;this.touchContainer.addClass("mp-imgswipe-move"),o>0?(this.backPicContainer.html(this.index_<=0?"":this.getImageElem(this.getPrevItem().url,this.getPrevItem().smallUrl)),this.touchContainer.css("-webkit-transform","translateX("+(this.index_<=0?o/2:o)+"px)")):(this.backPicContainer.html(this.index_>=i-1?"":this.getImageElem(this.getNextItem().url,this.getNextItem().smallUrl)),this.touchContainer.css("-webkit-transform","translateX("+(this.index_>=i-1?o/2:o)+"px)")),this.currentX=e},ptouch.ui.PictureSlider.prototype.handleTouchEnd=function(t){var e=this.currentX-this.startX,i=this.getItemCount();e>0?this.index_<=0||Math.abs(e)<40?(this.touchContainer.css({"-webkit-transition":".2s -webkit-transform ease-in-out","-webkit-transform":"translateX(0px)"}),setTimeout($.proxy(function(){this.touchContainer.removeClass("mp-imgswipe-move"),this.touchContainer.css({"-webkit-transition":""})},this),200)):(this.touchContainer.css({"-webkit-transition":".2s -webkit-transform ease-in-out","-webkit-transform":"translateX(500px)"}),setTimeout($.proxy(function(){this.handleLeftButtonClick(),this.touchContainer.css({"-webkit-transition":"","-webkit-transform":"translateX(0px)"})},this),200)):e<0&&(this.index_>=i-1||Math.abs(e)<40?(this.touchContainer.css({"-webkit-transition":".2s -webkit-transform ease-in-out","-webkit-transform":"translateX(0px)"}),setTimeout($.proxy(function(){this.touchContainer.removeClass("mp-imgswipe-move"),this.touchContainer.css({"-webkit-transition":""})},this),200)):(this.touchContainer.css({"-webkit-transition":".2s -webkit-transform ease-in-out","-webkit-transform":"translateX(-500px)"}),setTimeout($.proxy(function(){this.handleRightButtonClick(),this.touchContainer.css({"-webkit-transition":"","-webkit-transform":"translateX(0px)"})},this),200)))},ptouch.ui.PictureSlider.prototype.getPrevItem=function(){var t=this.getItemCount(),e=(this.index_-1+t)%t;return this.getItem(e)},ptouch.ui.PictureSlider.prototype.getNextItem=function(){var t=this.getItemCount(),e=(this.index_+1)%t;return this.getItem(e)},ptouch.ui.PictureSlider.loadedImageStack=[],ptouch.ui.PictureSlider.prototype.getImageElem=function(t,e){if(0==ptouch.ui.PictureSlider.loadedImageStack.length||-1!=$.inArray(t,ptouch.ui.PictureSlider.loadedImageStack))i=$('<div class="mp-imgswipe-img" style="background-image:url('+t+')" />');else{var i=$('<div class="mp-imgswipe-img" style="background-image:url('+e+')" />');$("<img>").load(function(){i.css({"background-image":"url("+t+")"}),ptouch.ui.PictureSlider.loadedImageStack.push(t)}).attr({src:t})}return i},ptouch.ui.PictureSlider.prototype.setIndex=function(t){var e=this.getItemCount();t=Math.max(Math.min(t,e-1),-1),ptouch.ui.PictureSlider.superClass_.setIndex.call(this,t);var i=this.getItem(t);if(i){this.touchContainer.removeClass("mp-imgswipe-move"),this.touchContainer.css("left",0);var o=this.getImageElem(i.url,i.smallUrl);this.picContainer.html(o),this.titleElem.html(i.title),this.indexElem.html(t+1+" / "+e),this.index_<=0?this.leftButton.addClass("mp-imgswipe-disabled"):this.leftButton.removeClass("mp-imgswipe-disabled"),this.index_>=e-1?this.rightButton.addClass("mp-imgswipe-disabled"):this.rightButton.removeClass("mp-imgswipe-disabled")}},ptouch.ui.PictureSlider.prototype.handleLeftButtonClick=function(){this.setIndex(--this.index_)},ptouch.ui.PictureSlider.prototype.handleRightButtonClick=function(){this.setIndex(++this.index_)},ptouch.ui.PictureSlider.prototype.handleCloseSlider=function(){this.element.remove()},$.provide("ptouch.Dock"),ptouch.Dock=function(t){ptouch.Dock.mainPageElement_||(ptouch.Dock.mainPageElement_=$("#main-page")),t||(t="page-"+ ++$.guid),this.id_=t,$(document).listen("closeAllDock",function(t){this.setVisible(!1)},this)},ptouch.Dock.prototype.id_="",ptouch.Dock.prototype.visible_=!1,ptouch.Dock.prototype.closeback_=!1,ptouch.Dock.prototype.element=null,ptouch.Dock.prototype.headerElem=null,ptouch.Dock.prototype.contentElem=null,ptouch.Dock.prototype.animateDuration_=200,ptouch.Dock.prototype.decorate=function(){},ptouch.Dock.prototype.getId=function(t){return this.id_},ptouch.Dock.prototype.setId=function(t){this.element&&this.element.attr("id",this.id_),this.id_=t},ptouch.Dock.prototype.setCloseBack=function(t){this.closeback_=t},ptouch.Dock.prototype.render=function(t,e){this.createDom(e),this.parentElem=t||"body",this.element.appendTo(this.parentElem),this.mask&&this.mask.appendTo(this.parentElem),this.bindEvents()},ptouch.Dock.prototype.createDom=function(t){this.element=$('<div id="'+this.id_+'" class="mpw-dock">').css({display:this.visible_?"block":"none"}),this.element.html('<div class="mpw-dock-header mpf-border-bottom mpf-border-top" mp-role="dockHeader"></div><div class="mpw-dock-content" mp-role="dockContent"></div><div class="mpg-iconfont mpw-dock-close" mp-role="closeButton">&#xe612;</div>'),t&&(this.mask=$('<div class="mpg-mask"></div>')),this.closeBtn=this.element.role("closeButton"),this.headerElem=this.element.role("dockHeader"),this.contentElem=this.element.role("dockContent")},ptouch.Dock.prototype.bindEvents=function(){this.closeBtn.listen("click",this.handleCloseClick,this),this.mask&&this.mask.listen("click",this.handleCloseClick,this)},ptouch.Dock.prototype.setHeader=function(t){t&&this.headerElem.html(t),this.headerElem.show()},ptouch.Dock.prototype.replaceHeader=function(t){t=$(t),this.headerElem.replaceWith(t),this.headerElem=t,this.headerElem.show()},ptouch.Dock.prototype.setContent=function(t){this.contentElem&&this.contentElem.html(t)},ptouch.Dock.prototype.handleBackClick=function(){this.setVisible(!1)},ptouch.Dock.prototype.handleCloseClick=function(){this.closeback_?this.setVisible(!1):(this.setVisible(!1),$(this).trigger("closeOneDock"))},ptouch.Dock.prototype.isVisible=function(){return this.visible_},ptouch.Dock.prototype.setVisible=function(t){this.visible_!=t&&(this.element&&(t?(this.element.show().addClass("mpw-dock-fadein"),this.mask&&this.mask.show()):(this.element.removeClass("mpw-dock-fadein"),this.mask&&this.mask.hide())),this.visible_=t)},ptouch.Dock.prototype.show=function(){this.setVisible(!0)},ptouch.Dock.prototype.hide=function(){this.setVisible(!1)},ptouch.Dock.prototype.getElement=function(){return this.element},ptouch.Dock.prototype.getHeaderElement=function(){return this.headerElem},ptouch.Dock.prototype.getContentElement=function(){return this.contentElem},$.provide("ptouch.calendar"),ptouch.calendar=function(t){ptouch.calendar.select=t,this._holidays=ptouch.calendar.holidays},ptouch.calendar.holidays={},ptouch.calendar.prototype={_init:function(){this._attachEvents()},_attachEvents:function(){},attachEvents:function(t){},render:function(t){var e=this,i=['<div class="mpw-calendar-body">'];for(var o in t){i.push('<div class="mpw-calendar-outer" mp-role="calendaronemonth"><table class="mpw-calendar">');var n=e._parseDate(o);i.push(e._renderHeader(n)+e._renderBody(n,t[o])),i.push("</table></div>"),0}return i.push("</div>"),i.join("")},_renderHeader:function(t){return'<caption class="mpw-calendar-caption">'+t.getFullYear()+"年"+(t.getMonth()+1)+"月</caption>"},_renderBody:function(t,e){var i='<thead>                        <tr>                            <th class="mpw-calendar-day">日</th>                            <th class="mpw-calendar-day">一</th>                            <th class="mpw-calendar-day">二</th>                            <th class="mpw-calendar-day">三</th>                            <th class="mpw-calendar-day">四</th>                            <th class="mpw-calendar-day">五</th>                            <th class="mpw-calendar-day">六</th>                        </tr>                    </thead>\t\t\t\t\t<tbody>',o=[],n=t.getFullYear(),a=t.getMonth(),r=this._getDaysInMonth(n,a+1),s=this._getDayOfWeek(n,a);0==s?s=1:s+=1;for(var c=s-1+r,l=2-s,p=0;l<=c;l++,p++){var h=new Date(n,a,l);if(p%7==0&&o.push("</tr>","<tr>"),l<1||l>r)o.push('<td class="mpw-calendar-unit"></td>');else{o.push('<td class="mpw-calendar-unit');var d=h.getDate();this._getTodayTime()==h.getTime()&&(d="今天",o.push(" mpw-calendar-current"));var u=n+"-"+(a+1)+"-"+l;this._holidays[u]&&(d=this._holidays[u].holidayName);var m=!1;e[l-1]||(o.push(" mpw-calendar-disabled"),m=!0),o.push('"'),m||o.push(' onclick="ptouch.calendar.select(event,'+n+","+(a+1)+","+l+');return false;"'),o.push(">"),o.push('<span class="mpw-calendar-bgc"></span>'),o.push('<span class="mpw-calendar-date">'),o.push(d),o.push("</span>"),!m&&e[l-1].price&&o.push('<strong class="mpg-price mpw-calendar-price">&yen;<em class="mpg-price-num">'+e[l-1].price+"</em></strong>"),o.push("</td>")}}return o=o.slice(1,-1),i=i+o.join("")+"</tbody></table>"},_isWeekend:function(t){return 6==t||0==t},_getTodayTime:function(){var t=new Date;return new Date(t.getFullYear(),t.getMonth(),t.getDate()).getTime()},_getDaysInMonth:function(t,e){var i=null;if(2==arguments.length)i=new Date(t,e,0);else{var o=new Date;i=new Date(o.getFullYear(),o.getMonth()+1,0)}return i.getDate()},_getDayOfWeek:function(t,e,i){if(3==arguments.length)return new Date(t,e,i).getDay();if(2==arguments.length)return new Date(t,e,1).getDay();var o=new Date;return new Date(o.getFullYear(),o.getMonth(),1).getDay()},_parseDate:function(t){var t=t.split("-");return new Date(t[0],parseInt(t[1],10)-1,1)}},$.provide("ptouch.Category"),ptouch.Category=function(t,e,i){this.url=t,this.exchangeToken=e||"",this.ignoreUserQualifies=i||!1},$.extend(ptouch.Category.prototype,{init:function(t,e,i,o,n){this.productId=t,this.type=e||0,this.classify=i,this.bookingUrl=o,this.cashbacknum=n,this.getData()},setType:function(t){this.type=t},attachEvent:function(t){this.attachSelectDateEvent(t),$("#mp-control-booking").listen("click",this.handleClickBookBtn,this)},attachSelectDateEvent:function(t){this.dateSelect||(this.exchangeToken?this.dateSelect=new ptouch.DateSelect(this.exchangeToken,this.ignoreUserQualifies):this.dateSelect=new ptouch.DateSelect("",this.ignoreUserQualifies),$(this.dateSelect).listen("changeDate",this.handleSelectCalendar,this),$(this.dateSelect).listen("dateselectCloseCover",function(){$(this).trigger("categoryCloseCover")},this)),this.dateSelect.init(t,this.productId,this.classify),$("[mp-role='dateshortcutkey']").listen("click",this.handleClickDateShortKey,this)},handleSelectCalendar:function(t){var e=t.dateElem,i=e.attr("data-date");$(".mpf-datecard-actived").removeClass("mpf-datecard-actived"),e.addClass("mpf-datecard-actived"),e.hasClass("mpf-datecard-wait")&&e.removeClass("mpf-datecard-wait"),e.find(".mpf-datecard-detail").html(this.getStrDate(i)),$(this).trigger(new $.Event("selectDate",{date:i,dateElem:e})),this.refreshCashbackNum(e)},refreshCashbackNum:function(t){var e=t.attr("data-cashbackamount"),i=t.attr("data-marketprice"),o=$('[mp-role="highMarketPrice"]'),n=$('[mp-role="page-category-cashback"]');if(0!=n.length)if(e&&"0"!=e){var a='<span class="mpf-cashbacktag"><span class="mpf-cashback-word">赠券</span><span class="mpf-cashback-payback">¥<em class="mpf-cashback-paynum">'+e+"</em></span></span>";n.html(a)}else n.html("");0!=o.length&&i&&o.html(i),this.displayMarketAndMarketingPrice(t)},handleClickDateShortKey:function(t){var e=$(t.target),i=e.hasClass("mpf-datecard")?e:e.parents(".mpf-datecard"),o=i.attr("data-date");$(".mpf-datecard-actived").removeClass("mpf-datecard-actived"),i.addClass("mpf-datecard-actived"),$(this).trigger(new $.Event("selectDate",{date:o,dateElem:i})),this.refreshCashbackNum(i)},setDateShorKey:function(t){this.handleClickDateShortKey({target:t})},openDatePanel:function(t){this.dateSelect.openDatePanel()},handleClickBookBtn:function(t){t.preventDefault();var e=$(t.target).attr("href");ptouch.getParam(e,"useDate")?(navigator.userAgent.indexOf("UCBrowser")>-1&&$(this).trigger("categoryCloseCover"),window.location.href=e):this.showPromptMsg("请选择日期")},showPromptMsg:function(t){var e=$('<div class="mp-toast-outer"><span class="mp-toast">'+t+"</span></div>");e.appendTo("body"),setTimeout(function(){e.remove()},1e3)},dealBookBtnAndPrice:function(t){var e=t.date,i=t.dateElem,o=$("#mp-control-booking"),n=o.attr("href"),a=i.attr("data-price");if(a){var r=$("#price"),s=$("#price-text");r.html(a),s.html("/张")}this.displayMarketAndMarketingPrice(i),ptouch.getParam(n,"useDate")?n=n.replace(ptouch.getParam(n,"useDate"),e):n+="&useDate="+e,o.attr("href",n)},displayMarketAndMarketingPrice:function(t){var e=t.attr("data-pricecashdesc"),i=$('[mp-role="highMarketPrice"]'),o=$('[mp-role="priceCashDesc"]');e?(o.html(e).parent().show(),i.length&&i.parent().hide()):(o.parent().hide(),i.length&&i.parent().show())},getData:function(){var t={id:this.productId,type:this.type};this.exchangeToken&&(t.exchangeToken=this.exchangeToken),$.ajax({url:this.url,type:"get",dataType:"json",data:t,context:this,success:this.getDataSuccess,error:this.getDataListError})},getDataSuccess:function(t){if(t&&t.ret)this.data=t.data,this.data&&this.dealCategoryData(this.data),$(this).trigger("renderCategory");else{var e=t?t.errmsg:"数据获取失败";this.showPromptMsg(e)}},dealCategoryData:function(t){t.bookingUrl=this.bookingUrl;for(var e=t.categoryList||[],i=0,o=e.length;i<o;i++){var n=e[i];if(n){var a=n.values;if("CALENDAR"==n.type){this.setShowDefaultDate();for(var r=this.defaultDateMap.dates,s=0,c=r.length;s<c;s++)for(var l=r[s],p=r[s].date,h=0,d=a.length;h<d;h++){var u=a[h];if(p==u.date){1==u.valid&&(l.valid=!0),u.price&&(this.ignoreUserQualifies?l.price=u.originQunarPrice:l.price=u.price),u.marketPrice&&(l.marketPrice=u.marketPrice),u.cashbackAmount&&(l.cashbackAmount=u.cashbackAmount),u.priceCashDesc&&(l.priceCashDesc=u.priceCashDesc),u.preferenPrice&&(l.preferenPrice=u.preferenPrice),l.maxBuyCount=u.maxBuyCount,l.minBuyCount=u.minBuyCount;break}}}}}},getDataListError:function(t){},setShowDefaultDate:function(){var t=new Date,e=t.getFullYear(),i=t.getMonth(),o=t.getDate();this.defaultDateMap={dates:[{displayName:"今天",dateStr:i+1+"月"+o+"日",date:[e,this.getFullDate(i+1),this.getFullDate(o)].join("-")},{displayName:"明天",dateStr:this.getShowMonth(e,i,o,1)+1+"月"+this.getShowDate(e,i,o,1)+"日",date:[this.getShowYear(e,i,o,1),this.getFullDate(this.getShowMonth(e,i,o,1)+1),this.getFullDate(this.getShowDate(e,i,o,1))].join("-")},{displayName:"后天",dateStr:this.getShowMonth(e,i,o,2)+1+"月"+this.getShowDate(e,i,o,2)+"日",date:[this.getShowYear(e,i,o,2),this.getFullDate(this.getShowMonth(e,i,o,2)+1),this.getFullDate(this.getShowDate(e,i,o,2))].join("-")},{displayName:"其他日期",dateStr:"",date:"",valid:!0,isMoreBtn:!0}]}},getShowYear:function(t,e,i,o){return new Date(t,e,i+o).getFullYear()},getShowMonth:function(t,e,i,o){return new Date(t,e,i+o).getMonth()},getShowDate:function(t,e,i,o){return new Date(t,e,i+o).getDate()},getFullDate:function(t){return t<10?"0"+t:t+""},getStrDate:function(t,e){var i=t.split("-");return e?i[0]+"年"+parseInt(i[1])+"月"+parseInt(i[2])+"日":parseInt(i[1])+"月"+parseInt(i[2])+"日"}}),$.provide("ptouch.DateSelect"),ptouch.DateSelect=function(t,e){this.exchangeToken=t||"",this.ignoreUserQualifies=e||!1},ptouch.DateSelect.prototype={init:function(t,e,i,o){this.dateElem=$(t),this.pid=e,this.classify=i,this.showMask=o||!1,this.dateElem.attr("readonly",!0).listen("click",this.handleClick,this),this.loadedDateList={}},getFullDate:function(t){return t<10?"0"+t:t+""},getStrDate:function(t,e){var i=t.split("-");return e?i[0]+"年"+parseInt(i[1])+"月"+parseInt(i[2])+"日":parseInt(i[1])+"月"+parseInt(i[2])+"日"},handleGetDataSuccess:function(t){this.loadedDateList[this.pid]=t;for(var e={},i=/(\d+)\-(\d+)\-(\d+)/,o=0,n=t.length;o<n;o++){var a=t[o],r=a.date.match(i);if(r){var s=r[1]+"-"+r[2];if(e[s]||(e[s]=[],e[s].length=31),a.price){this.ignoreUserQualifies&&(a.price=a.originQunarPrice);var c=parseInt(r[3],10)-1;e[s][c]={},e[s][c].price=Math.round(100*parseFloat(a.price))/100,void 0!==a.minBuyCount&&void 0!==a.maxBuyCount&&(e[s][c].max=parseInt(a.maxBuyCount,10),e[s][c].min=parseInt(a.minBuyCount,10))}}}this.calendarPopup.setHeader('<span class="mpg-iconfont mpw-dock-back" mp-role="calendarback" style="display:none;">&#xe904;</span>选择时间'),this.calendar=new ptouch.calendar($.proxy(this.onSelect,this)),this.calendarElemTpl=this.calendar.render(e),this.calendarPopup.setContent(this.calendarElemTpl),this.calendar.attachEvents(this.calendarPopup.element),$('[mp-role="calendarback"]').listen("click",function(){this.calendarPopup.hide()},this)},handleGetFailed:function(t){this.calendarPopup.setHeader("加载失败")},handleClick:function(t){if(!this.calendarPopup){this.calendarPopup=new ptouch.Dock,this.calendarPopup.setCloseBack(!0),this.calendarPopup.render("#main-page",this.showMask),$(this.calendarPopup).listen("closeOneDock",function(){$(this).trigger("dateselectCloseCover")},this)}if(!this.loadedDateList[this.pid]){var e={pid:this.pid,classify:this.classify};this.exchangeToken&&(e.exchangeToken=this.exchangeToken),$.ajax({url:"/touch/sight/calendar.json",type:"post",dataType:"json",data:e,context:this,success:this.handleGetDataSuccess,fail:this.handleGetFailed}),this.calendarPopup.setHeader('<div style="padding:18px;">加载中...</div>')}this.calendarPopup.show()},openDatePanel:function(){this.handleClick()},onSelect:function(t,e,i,o){this.calendarPopup.hide(),$(".mpw-calendar-selected").removeClass("mpw-calendar-selected"),$(t.currentTarget).addClass("mpw-calendar-selected");for(var n,a,r,s,c,l,p=e+"-"+this.getFullDate(i)+"-"+this.getFullDate(o),h=0,d=this.loadedDateList[this.pid],u=0,m=d.length;u<m;u++)if((o=d[u]).date==p){n=o.price,a=o.marketPrice,r=o.maxBuyCount,s=o.minBuyCount,c=o.priceCashDesc,l=o.preferenPrice,o.cashbackAmount&&(h=o.cashbackAmount);break}this.dateElem.attr({"data-date":p,"data-price":n,"data-marketprice":a,"data-maxbuycount":r,"data-minbuycount":s,"data-cashbackamount":h,"data-pricecashdesc":c,"data-preferenprice":l}),setTimeout($.proxy(function(){this.dateElem.focus()},this),500),$(this).trigger(new $.Event("changeDate",{dateElem:this.dateElem}))},rememberSel:function(){window.location.href.match(/pid\=([^\&\#\?]*)/);try{this.storage=window.localStorage}catch(t){return}if(this.storage){var t=this.storage.getItem("selDate");t&&((t=$.parseJSON(t)).pid==this.pid?this.setStoreDate(t.date):this.storage.removeItem("selDate"))}},storeSetItem:function(t,e){this.storage&&this.storage.setItem(t,'{"date":"'+e+'","pid":"'+this.pid+'"}')},setStoreDate:function(t){this.dateElem.attr("data-date",t);var e=this;window.setTimeout(function(){$(e).trigger(new $.Event("changeDate",{dateElem:e.dateElem}))},500)}},void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.category=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.b('<div class="mpf-control-outer">\r'),o.b("\n"+i),o.b('    <div class="mp-booking-info">\r'),o.b("\n"+i),o.b('        <h5 class="mpf-booking-title">'),o.b(o.v(o.f("ticketName",t,e,0))),o.b("</h5>\r"),o.b("\n"+i),o.b('        <p class="mpf-booking-price" mp-role="page-category-pricearea">\r'),o.b("\n"+i),o.b('            <span class="mpg-price">&yen;<em class="mpg-price-num" id="price">'),o.b(o.v(o.f("lowerPrice",t,e,0))),o.b("</em></span>\r"),o.b("\n"+i),o.b('            <span id="price-text">起/张</span>\r'),o.b("\n"+i),o.b('            <span class="mp-prdcard-gray mp-prdcard-marketing"'),o.s(o.f("priceCashDesc",t,e,1),t,e,1,0,0,"")||o.b(' style="display:none"'),o.b('><span mp-role="priceCashDesc">'),o.b(o.v(o.f("priceCashDesc",t,e,0))),o.b("</span></span>\r"),o.b("\n"+i),o.s(o.f("highMarketPrice",t,e,1),t,e,0,567,803,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('            <span class="mp-prdcard-gray mp-prdcard-marketprice mpf-booking-marketprice"'),o.s(o.f("priceCashDesc",t,e,1),t,e,0,675,696,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b(' style="display:none"')}),t.pop()),o.b('>票面价:&yen;<span mp-role="highMarketPrice">'),o.b(o.v(o.f("highMarketPrice",t,e,0))),o.b("</span></span>\r"),o.b("\n"+i)}),t.pop()),o.b('            <span mp-role="page-category-cashback">\r'),o.b("\n"+i),o.s(o.f("maxCashBack",t,e,1),t,e,0,910,1185,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('                <span class="mpf-cashbacktag">\r'),o.b("\n"+i),o.b('                    <span class="mpf-cashback-word">赠券</span>\r'),o.b("\n"+i),o.b('                    <span class="mpf-cashback-payback">&yen;<em class="mpf-cashback-paynum">'),o.b(o.v(o.f("maxCashBack",t,e,0))),o.b("</em></span>\r"),o.b("\n"+i),o.b("                </span>\r"),o.b("\n"+i)}),t.pop()),o.b("            </span>\r"),o.b("\n"+i),o.b("        </p>\r"),o.b("\n"+i),o.b("    </div>\r"),o.b("\n"+i),o.s(o.f("categoryList",t,e,1),t,e,0,1271,1481,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('    <div class="mpf-booking-select" data-type="'),o.b(o.v(o.f("type",t,e,0))),o.b('">\r'),o.b("\n"+i),o.b('        <h6 class="mpf-booking-note" mp-role="categorytitle">'),o.b(o.v(o.f("title",t,e,0))),o.b("</h6>\r"),o.b("\n"+i),o.b("    </div>\r"),o.b("\n"+i),o.b('    <div class="mpf-booking-light">'),o.b(o.v(o.f("playLimit",t,e,0))),o.b("</div>\r"),o.b("\n"+i)}),t.pop()),o.b("</div>\r"),o.b("\n"+i),o.b('<a title="门票预订" class="mpf-booking-btn" id="mp-control-booking" href="'),o.b(o.v(o.f("bookingUrl",t,e,0))),o.b('">立即预订</a>'),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.category),void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.calendarcategory=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.b('<div class="mpf-booking-datecard clrfix">       \r'),o.b("\n"+i),o.s(o.f("dates",t,e,1),t,e,0,64,740,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('    <span class="mpf-datecard '),o.s(o.f("valid",t,e,1),t,e,1,0,0,"")||o.b("mpf-datecard-disabled"),o.b(" "),o.s(o.f("isMoreBtn",t,e,1),t,e,0,152,169,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b("mpf-datecard-wait")}),t.pop()),o.b('" '),o.s(o.f("isMoreBtn",t,e,1),t,e,0,199,238,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('id="alldate" data-type="selectCalendar"')}),t.pop()),o.b(" "),o.s(o.f("isMoreBtn",t,e,1),t,e,1,0,0,"")||o.s(o.f("valid",t,e,1),t,e,0,277,302,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('mp-role="dateshortcutkey"')}),t.pop()),o.b(' data-date="'),o.b(o.v(o.f("date",t,e,0))),o.b('" data-maxbuycount="'),o.b(o.v(o.f("maxBuyCount",t,e,0))),o.b('" data-minbuycount="'),o.b(o.v(o.f("minBuyCount",t,e,0))),o.b('" data-price="'),o.b(o.v(o.f("price",t,e,0))),o.b('" data-marketprice="'),o.b(o.v(o.f("marketPrice",t,e,0))),o.b('" data-cashbackamount="'),o.b(o.v(o.f("cashbackAmount",t,e,0))),o.b('" data-pricecashdesc="'),o.b(o.v(o.f("priceCashDesc",t,e,0))),o.b('" data-preferenprice="'),o.b(o.v(o.f("preferenPrice",t,e,0))),o.b('">\r'),o.b("\n"+i),o.b('        <em class="mpf-datecard-name">'),o.b(o.v(o.f("displayName",t,e,0))),o.b("</em>\r"),o.b("\n"+i),o.b('        <strong class="mpf-datecard-detail">'),o.b(o.v(o.f("dateStr",t,e,0))),o.b("</strong>\r"),o.b("\n"+i),o.b("    </span>\r"),o.b("\n"+i)}),t.pop()),o.b("</div>"),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.calendarcategory),$.provide("ptouch.Layer"),ptouch.Layer=function(t){this.title_=t||"说明",this.window_=$(window)},ptouch.Layer.tpl='<div><div class="mpw-layer-mask" mp-role="mask"></div><div class="mpw-layer" mp-role="layer"><div class="mpw-layer-title mpf-border-bottom" mp-role="layerTitleArea"><h2 mp-role="layerTitle" class="mp-layer-title-text"></h2><span class="mpw-layer-close mpg-iconfont" mp-role="layerCloseButton">&#xe612;</span></div><div class="mpw-layer-content" mp-role="layerContent"><div class="mpw-layer-inner-content" mp-role="layerInnerContent"></div></div><div mp-role="layerFooter"></div></div></div>',$.extend(ptouch.Layer.prototype,{render:function(t){this.createDom(t),this.show(),this.bindEvents()},createDom:function(t){this.element_=$(ptouch.Layer.tpl),this.mask_=this.element_.find("[mp-role=mask]"),this.layer_=this.element_.find("[mp-role=layer]"),this.layerTitleArea_=this.element_.find("[mp-role=layerTitleArea]"),this.layerTitle_=this.element_.find("[mp-role=layerTitle]"),this.layerContent_=this.element_.find("[mp-role=layerContent]"),this.layerInnerContent_=this.element_.find("[mp-role=layerInnerContent]"),this.layerFooter_=this.element_.find("[mp-role=layerFooter]"),this.closeButton_=this.element_.find("[mp-role=layerCloseButton]"),this.layerTitle_.text(this.title_),t?$(t).append(this.element_):$("body").append(this.element_)},setTitle:function(t){this.layerTitle_.text(t)},resetPosition:function(){var t=this.window_.height(),e=this.window_.width(),i=this.layerTitleArea_.height(),o=this.footerHeight?this.footerHeight:0;this.layer_.css({height:t-60,width:e-20,marginLeft:-(e/2-10),marginTop:-(t/2-30)}),this.resetContentHeight(t-60-i-o)},bindEvents:function(){this.closeButton_.listen("click",this.hide,this),this.mask_.listen("click",this.hide,this),this.mask_.listen("touchmove",function(t){t.preventDefault()}),$(window).listen("resize",this.handleWindowResize,this)},hide:function(){this.layer_.hide(),this.mask_.hide()},show:function(){this.iscroll_||(this.iscroll_=new $.IScroll(this.layerContent_.get(0))),this.layer_.show(),this.resetPosition(),this.mask_.show()},handleWindowResize:function(){this.resetPosition()},setContent:function(t,e){this.layerInnerContent_.html(t),this.iscroll_.refresh(),e&&(this.iscroll_.options.onScrollEnd=$.proxy(this.handleScrollEnd_,this))},setFooterContent:function(t){this.layerFooter_.html(t),this.footerHeight=$(t).height();var e=this.layerContent_.height()-this.footerHeight;this.resetContentHeight(e)},refreshTitle:function(t){var e=this.layerTitleArea_.height();this.layerTitle_.replaceWith(t),this.layerTitle_=this.element_.find("[mp-role=layerTitle]");var i=this.layerTitleArea_.height(),o=this.layerContent_.height()+e-i;this.resetContentHeight(o)},resetContentHeight:function(t){this.layerContent_.css({height:t}),this.iscroll_.refresh()},getLayerContent:function(){return this.layerContent_},handleScrollEnd_:function(){this.layerContent_.trigger("scroll")},destroy:function(){this.element_.remove()}}),$.provide("ptouch.Qchat"),ptouch.Qchat=function(t,e,i,o,n){this.qchatElem=t,this.setQchatParam(e,i,o,n),this.importJS()},ptouch.Qchat.prototype.setQchatParam=function(t,e,i,o){t&&e||this.qchatElem.hide(),"undefined"==typeof QNR&&(QNR={}),window.QCHAT={businessId:t,busiSupplierId:e,service_type:i,productId:o}},ptouch.Qchat.prototype.init=function(){var t=this,e=setInterval(function(){window.QNR.TouchQChat&&(window.QNR.TouchQChat.init({offlineCallback:function(){return t.qchatElem.show(),!0},onlineCallback:function(){t.qchatElem.show()},hasNoWaiter:function(){t.qchatElem.hide()}}),clearInterval(e))},100)},ptouch.Qchat.prototype.importJS=function(){var t=document.createElement("script");t.type="text/javascript",t.src="//q.qunarzz.com/qtalk-common/prd/touchQchat.js?"+(new Date).getTime(),document.head.appendChild(t);var e=this;t.onload=function(){e.init()}},void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.minititle=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.b('<div class="mp-prdinfo-title" mp-role="layerTitle">\r'),o.b("\n"+i),o.b('    <h2 class="mp-prdinfo-prdname">'),o.b(o.v(o.f("ticketName",t,e,0))),o.b("</h2>\r"),o.b("\n"+i),o.b('    <div class="mp-prdinfo-headdetail">\r'),o.b("\n"+i),o.b('        <div class="mp-prdinfo-suppliername">'),o.s(o.f("isQunarStraightSale",t,e,1),t,e,0,219,261,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('<span class="mp-prdinfo-qunaricon"></span>')}),t.pop()),o.b(o.v(o.f("supplierName",t,e,0))),o.b("</div>\r"),o.b("\n"+i),o.b('        <div class="mp-prdinfo-headtags">\r'),o.b("\n"+i),o.s(o.f("activitys",t,e,1),t,e,0,375,686,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b("\t            "),o.s(o.f("limitTime",t,e,1),t,e,0,404,511,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('<span class="mp-prdinfo-tag"><span class="mpg-iconfont mp-prdinfo-tag-icon">&#xe913;</span>'),i.b(i.v(i.f("label",t,e,0))),i.b("</span>")}),t.pop()),o.b("\r"),o.b("\n"+i),o.b("\t            "),o.s(o.f("limitTime",t,e,1),t,e,1,0,0,"")||(o.b('<span class="mp-prdinfo-tag"><span class="mpg-iconfont mp-prdinfo-tag-icon">&#xe604;</span>'),o.b(o.v(o.f("label",t,e,0))),o.b("</span>")),o.b("\r"),o.b("\n"+i)}),t.pop()),o.b("        </div>\r"),o.b("\n"+i),o.b("    </div>\r"),o.b("\n"+i),o.b("</div>"),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.minititle),void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.miniproddetail=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.s(o.f("introData",t,e,1),t,e,0,14,2503,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.s(o.f("infosSingle",t,e,1),t,e,0,36,2140,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.s(o.d("infosGroup.length",t,e,1),t,e,0,68,502,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.s(o.f("infosGroup",t,e,1),t,e,0,97,477,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('            <div class="mp-group-con mpf-border-bottom">\r'),o.b("\n"+i),o.b('                <div class="mp-prdintro-item mp-prdintro-boon">\r'),o.b("\n"+i),o.b('                    <div class="mp-prdintro-icon">'),o.b(o.v(o.f("typeSign",t,e,0))),o.b("</div>\r"),o.b("\n"+i),o.b('                    <div class="mp-prdintro-desc">\r'),o.b("\n"+i),o.b("                        <div>"),o.b(o.t(o.f("content",t,e,0))),o.b("</div>\r"),o.b("\n"+i),o.b("                    </div>\r"),o.b("\n"+i),o.b("                </div>\r"),o.b("\n"+i),o.b("            </div>\r"),o.b("\n"+i)}),t.pop())}),t.pop()),o.s(o.f("infosGroup",t,e,1),t,e,1,0,0,"")||o.s(o.f("notGroup",t,e,1),t,e,0,576,2096,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('            <div class="mp-group-con mpf-border-bottom">\r'),o.b("\n"+i),o.b('                <div class="mp-prdintro-item">\r'),o.b("\n"+i),o.b('                    <div class="mp-prdintro-icon'),o.s(o.f("isIcon",t,e,1),t,e,0,743,759,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b(" mp-prdintro-tag")}),t.pop()),o.b('">\r'),o.b("\n"+i),o.s(o.f("isIcon",t,e,1),t,e,0,809,1238,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.s(o.f("notRefund",t,e,1),t,e,0,853,1006,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('                            <span class="mpg-iconfont mp-prdinfo-tag-icon mp-prdinfo-invalid">&#xe605;</span>'),o.b(o.v(o.f("typeSign",t,e,0))),o.b("\r"),o.b("\n"+i)}),t.pop()),o.s(o.f("notRefund",t,e,1),t,e,1,0,0,"")||(o.b('                            <span class="mpg-iconfont mp-prdinfo-tag-icon">&#xe604;</span>'),o.b(o.v(o.f("typeSign",t,e,0))),o.b("\r"),o.b("\n"+i))}),t.pop()),o.s(o.f("isIcon",t,e,1),t,e,1,0,0,"")||(o.b("                            "),o.b(o.v(o.f("typeSign",t,e,0))),o.b("\r"),o.b("\n"+i)),o.b("                    </div>\r"),o.b("\n"+i),o.b('                    <div class="mp-prdintro-desc">\r'),o.b("\n"+i),o.b("                        <div "),o.s(o.f("notRefund",t,e,1),t,e,0,1490,1524,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('class="mp-prdintro-desc-notrefund"')}),t.pop()),o.b(">\r"),o.b("\n"+i),o.b("                            "),o.b(o.t(o.f("content",t,e,0))),o.b("\r"),o.b("\n"+i),o.b("                        </div>\r"),o.b("\n"+i),o.s(o.f("notRefund",t,e,1),t,e,0,1653,1795,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b("                            "),o.s(o.f("desc",t,e,1),t,e,0,1692,1760,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('<div class="mp-notrefund-desc" mp-role="noRefundInfo">'),i.b(i.v(i.f("desc",t,e,0))),i.b("</div>")}),t.pop()),o.b("\r"),o.b("\n"+i)}),t.pop()),o.b("                    </div>\r"),o.b("\n"+i),o.s(o.f("notRefund",t,e,1),t,e,0,1873,2024,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b("                        "),o.s(o.f("desc",t,e,1),t,e,0,1908,1993,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b('<div class="mpg-iconfont mp-notrefund-morebtn" mp-role="noRefundInfoBtn">&#x45;</div>')}),t.pop()),o.b("\r"),o.b("\n"+i)}),t.pop()),o.b("                </div>\r"),o.b("\n"+i),o.b("            </div>\r"),o.b("\n"+i)}),t.pop())}),t.pop()),o.b('    <div class="mp-group-con mpf-border-bottom">\r'),o.b("\n"+i),o.s(o.f("infos",t,e,1),t,e,0,2226,2479,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.s(o.f("single",t,e,1),t,e,1,0,0,"")||(o.b('            <div class="mp-prddetail-item">\r'),o.b("\n"+i),o.b('                <h5 class="mp-prddetail-name">'),o.b(o.v(o.f("typeName",t,e,0))),o.b("</h5>\r"),o.b("\n"+i),o.b('                <p class="mp-prodetail-desc">'),o.b(o.t(o.f("content",t,e,0))),o.b("</p>\r"),o.b("\n"+i),o.b("            </div>\r"),o.b("\n"+i))}),t.pop()),o.b("    </div>\r"),o.b("\n"+i)}),t.pop()),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.miniproddetail),void 0===window.QTMPL&&(window.QTMPL={}),window.QTMPL.minibookarea=new window.Hogan.Template({code:function(t,e,i){var o=this;return o.b(i=i||""),o.s(o.f("showBookBtn",t,e,1),t,e,0,16,1026,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('<div class="mpm-fixbooking-con mpg-flexbox">\r'),o.b("\n"+i),o.b('    <div class="mpm-fixbooking-pricecon mpf-border-top mpg-flexbox-item'),o.s(o.f("marketingPriceDesc",t,e,1),t,e,0,158,183,"{{ }}")&&(o.rs(t,e,function(t,e,i){i.b(" mpm-fixbooking-moreprice")}),t.pop()),o.b('">\r'),o.b("\n"+i),o.b('        <span class="mpm-fixbooking-priceitemsingle">\r'),o.b("\n"+i),o.b('            <em class="mpm-fixbooking-priceicon">'),o.b(o.v(o.f("payWayStr",t,e,0))),o.b('&nbsp;&nbsp;</em>&yen;<span class="mpm-fixbooking-price">'),o.b(o.v(o.f("qunarPrice",t,e,0))),o.b("</span>\r"),o.b("\n"+i),o.b("        </span>\r"),o.b("\n"+i),o.s(o.f("marketingPriceDesc",t,e,1),t,e,0,455,555,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('            <span class="mp-price mpm-fixbooking-subprice">'),o.b(o.v(o.f("marketingPriceDesc",t,e,0))),o.b("</span>\r"),o.b("\n"+i)}),t.pop()),o.b("    </div>\r"),o.b("\n"+i),o.s(o.f("qchat",t,e,1),t,e,0,606,832,"{{ }}")&&(o.rs(t,e,function(t,e,o){o.b('    <div class="qchat-button mp-fixbooking-qchat mpf-border-topleft" mp-role="qchatEntrance">\r'),o.b("\n"+i),o.b('        <span class="mpg-iconfont mp-qchat-icon">&#xe90a;</span>\r'),o.b("\n"+i),o.b('        <span class="mp-qchat-text">咨询</span>\r'),o.b("\n"+i),o.b("    </div>\r"),o.b("\n"+i)}),t.pop()),o.b('    <div class="mpm-fixbooking-btn mpg-flexbox-item">\r'),o.b("\n"+i),o.b('        <a href="" mp-role="booking-link" data-click="true" data-click-value="t_mini_window_buy">立即预订</a>\r'),o.b("\n"+i),o.b("    </div>\r"),o.b("\n"+i),o.b("</div>\r"),o.b("\n"+i)}),t.pop()),o.fl()},partials:{},subs:{}}.code),"undefined"!=typeof module&&(module.exports=window.QTMPL.minibookarea),$.provide("ptouch.product.MiniDetail"),ptouch.product.MiniDetail=function(t,e,i,o,n){this.page=t||"",this.productId=e||"",this.orderId=i||"",this.showFooter=o||!1,this.title=n||"购买须知",this.url=ptouch.API_GET_PRODETAIL,this.loadingElem_=$('<div class="mp-loading-container"><span>数据加载中，请稍候...</span></div>'),this.refreshElem_=$('<a mp-role="refresh">重试</a>'),this.introData_={},this.layer=new ptouch.Layer(this.title),this.layer.render($("#main-page"))},$.extend(ptouch.product.MiniDetail.prototype,{init:function(){this.attachEvent(),this.getData()},getData:function(){this.layer.setContent(this.loadingElem_),$.ajax({type:"get",dataType:"json",data:{productId:this.productId,orderId:this.orderId,page:this.page},url:this.url,success:this.handleGetProductSuccess,error:this.handleGetProductError,timeout:1e4,context:this})},attachEvent:function(){this.refreshElem_.listen("click",this.getData,this)},handleGetProductSuccess:function(t){t.ret?(this.introData_=this.decorateIntroData(t.data),this.setProductDetailIntro(this.introData_)):this.layer.setContent(t.errmsg)},handleGetProductError:function(){var t=$('<div class="mp-error-container">请求失败，请</div>');t.append(this.refreshElem_),this.layer.setContent(t)},setProductDetailIntro:function(t){this.layer.refreshTitle(QTMPL.minititle.render(t)),this.layer.setContent(QTMPL.miniproddetail.render({introData:t})),t.showBookBtn&&this.showFooter&&(this.layer.setFooterContent($(QTMPL.minibookarea.render(t))),this.bookBtn=this.layer.element_.find('[mp-role="booking-link"]'),this.bookBtn.listen("click",this.handleClickBookBtn,this),this.noRefundInfoBtn=this.layer.element_.role("noRefundInfoBtn"),this.noRefundInfoBtn.listen("click",this.handleNoRefundInfoBtnClick,this),this.initQchat(t))},handleClickBookBtn:function(t){t.preventDefault(),$(this).trigger(new $.Event("clickBookBtn",{productId:this.productId})),this.close()},handleNoRefundInfoBtnClick:function(){var t=this.layer.element_.role("noRefundInfo");this.isNoRefundInfoShown?(this.isNoRefundInfoShown=!1,this.noRefundInfoBtn.html("&#x45;"),t.hide()):(this.isNoRefundInfoShown=!0,this.noRefundInfoBtn.html("&#x44;"),t.show())},initQchat:function(t){var e=t.qchat;e&&new ptouch.Qchat($(".qchat-button"),e.businessId,t.encryptSupplierId,e.serviceType,this.productId)},close:function(){this.layer.hide()},show:function(){this.layer.show()},decorateIntroData:function(t){var t=$.extend({},t);activitys=t.activitys||[],infos=t.infos||{},infosSingle=[{infosGroup:[]}];for(var e=0,i=activitys.length;e<i;e++)9==activitys[e].type?activitys[e].limitTime=!0:activitys[e].limitTime=!1;for(var o=0,n=infos.length;o<n;o++){var a=infos[o];a.content=a.content.replace(/\r*\n/g,"<br />"),a.typeSign?(0==a.displayType?infosSingle[0].infosGroup.push(a):(a.notGroup=!0,infosSingle.push(a)),a.single=!0):a.single=!1,13==a.type&&(a.isIcon=!0,"不可退"==a.typeName&&(a.notRefund=!0))}if(t.activitys=activitys,t.infos=infos,t.infosSingle=infosSingle,void 0!==t.payWay&&void 0!==t.qunarPrice)switch(t.payWay){case"PREPAY":t.showBookBtn=!0,t.payWayStr="在线支付";break;case"CASHPAY":t.showBookBtn=!0,t.pwaWayStr="景区支付"}return t}}),$.provide("ptouch.sight.detail.TicketPrice"),ptouch.sight.detail.TicketPrice=function(t){this.context=window.context,this.pageContainer=t,this.container=this.pageContainer.find(".mp-ticket-container"),this.window_=$(window),this.moreButtonList=$.role("moreButton"),this.ticketMainZoneList=$.role("TicketMainZone"),this.ticketTypeTileList=$.role("TicketTypeTitle"),this.ticketLinkList=$.role("TicketLink"),this.scrollTop=this.window_.scrollTop(),this.detailData={},this.SupplierType={TUAN:1,VIP:2,GENERAL:3,CPC:4}},$.extend(ptouch.sight.detail.TicketPrice.prototype,{init:function(){this.resetTicketLinks(),this.bindEvents(),this.openFirstTicket(),this.openDetailWindow(),this.addAnalysisParam()},resetTicketLinks:function(){var t=this.container.role("promoteArea").role("downloadAppBtn");if("app"==$.env.platform){var e=this.container.find("a");ptouch.adaptAppLink(e),this.adaptHyLink(e),t.addClass("mp-promote-ablebtn")}else{for(var i=!1,o="//touch.qunar.com/client/?sScheme=0&scheme="+encodeURIComponent("sight/detail?id="+this.context.sightId),n=0;n<t.length;n++){var a=t.eq(n);if(a.attr("data-app")){i=!0,a.text("下载APP").addClass("mp-promote-disablebtn");var r=a.closest("a"),s=a.closest("[mp-role=TicketItem]");r.attr("href",o),s.attr("data-disabled",!0)}else a.addClass("mp-promote-ablebtn")}i&&(this.leftDownloadArea=$.role("appDownLeft"),this.leftDownloadArea.attr("href",o),this.window_.listen("scroll",this.handleWindowScroll,this))}},handleWindowScroll:function(t){this.timeoutId_||(this.timeoutId_=setTimeout($.proxy(function(){var t=$(window).scrollTop();t<this.scrollTop_?this.leftDownloadArea.show():this.leftDownloadArea.hide(),this.scrollTop_=t,this.timeoutId_=null},this),30))},adaptHyLink:function(t){for(var e=0;e<t.length;e++){var i=t.eq(e),o=i.attr("href");(o.indexOf("spu/onedaytour.htm")>-1||o.indexOf("spu/onedaytour.htm")>-1)&&(0!=o.indexOf("http")&&0!=o.indexOf("https")&&(o=0!=o.indexOf("//")?location.protocol+"//"+location.host+o:location.protocol+o),o=$.env.scheme+"://hy?url="+encodeURIComponent(o)+"&type=navibar-none",i.attr("href",o))}},bindEvents:function(){this.moreButtonList.listen("click",this.handleMoreButtonClick,this),this.ticketMainZoneList.listen("click",this.handleTicketMainZoneClick,this),this.ticketTypeTileList.listen("click",this.handleTicketTypeTitleClick,this),this.ticketLinkList.listen("click",this.handleOrderLinkClick,this)},handleMoreButtonClick:function(t){var e=$(t.currentTarget);e.siblings().show(),e.remove()},handleTicketMainZoneClick:function(t){var e=$(t.currentTarget).parent(),i=e.data("tickettype"),o=e.find('[data-clktype="product-detail"]'),n=e.find("[mp-role=TicketLink]").attr("href");0!=o.length?o.closest("[mp-role=TicketItem]").attr("data-disabled")||this.getProductDetail(o):i&&n&&(window.location.href=n)},getProductDetail:function(t){var e=t.attr("data-pid");void 0!==this.detailData[e]?this.detailData[e].show():(this.detailData[e]=new ptouch.product.MiniDetail("sight_detail",e,null,!0,null),this.detailData[e].init(),$.listen(this.detailData[e],"clickBookBtn",this.handleProductMiniDetailBook,this))},handleProductMiniDetailBook:function(t){for(var e,i='[data-pid="'+t.productId+'"]',o=this.ticketLinkList.filter(i),n=0;n<o.length;n++){var a=o.eq(n);if(isDisabled=a.closest("[mp-role=TicketItem]").attr("data-disabled"),!isDisabled){e=a;break}}this.preHandleOrderLinkClick(e)},preHandleOrderLinkClick:function(t){"true"===this.context.isLogin&&"true"===t.attr("data-inactivity")?$.ajax({type:"post",dateType:"json",data:{redIds:t.attr("data-redid"),t:+new Date},url:"/touch/canUseRedPacket.json",success:function(i){i.ret?this.handleShowTouch2App(t):this.handleTicketClick(t,e)},context:this}):this.handleTicketClick(t)},handleShowTouch2App:function(t){var e=this;e.initParm={type:"confirm",title:"友情提示",content:"使用去哪儿旅行客户端预订，可使用红包支付，享立减优惠",okText:"直接预订",cancelText:"使用客户端",handleCancel:function(){var e=t.attr("href"),i=ptouch.getParam(e,"pid"),o=ptouch.getParam(e,"priceId");window.location.href="http://touch.qunar.com/h5/client?bd_source=qunar&sScheme=0&scheme="+encodeURIComponent("sight/booking?pid="+i+"&productId="+i+"&priceId="+o+"&classify=1")+"&touchUrl=download"},handleOk:function(){e.handleTicketClick(t),e.bookingConfirm.destroy(),e.bookingConfirm=null},handleClose:function(){e.bookingConfirm.destroy(),e.bookingConfirm=null}},e.bookingConfirm=new ptouch.Dialog(e.initParm),e.bookingConfirm.show()},handleTicketClick:function(t){t.attr("data-supplierid");var e=t.attr("data-suppliername"),i=t.attr("data-suppliertype"),o=t.attr("data-hasmob"),n=t.attr("href");if(i==this.SupplierType.CPC&&o){if(n=t.attr("data-moburl"),!this.alertPopup){var a=new ptouch.PopupPage("alert");a.setTitle("预订提醒"),a.create("body"),this.alertPopup=a}this.alertPopup.setContent('<div style="margin-bottom:10px; background:white; padding:10px;">此门票由“'+e+"”提供预订服务。请务必阅读相关预订须知，并咨询“"+e+'”客服后购买门票。购票请记住"'+e+'"的售后联系方式。<br>对于您在“'+e+'”购买门票的行为，“去哪儿网”将不承担任何责任，具体请参见“去哪儿网”免责声明</div>                    <div class="mp-group mp-intro-buttons"><div onclick="window.location.href=\''+n+'\';" class="mp-row mp-row-activable"><span class="light">前往"'+e+'"预订</span><i class="mp-row-arrow"></i></div></div>                    <div class="mp-group mp-intro-buttons"><div onclick="window.location.href=\'/touch/order/noduty.htm\';" class="mp-row mp-row-activable"><span class="light">查看"去哪儿网"免责声明</span><i class="mp-row-arrow"></i></div></div>'),ptouch.Route.getInstance().showPage("alert",this.alertPopup)}else"0"==t.attr("data-teamtype")?this.selectCategory(t):window.location.href=t.attr("href")},openFirstTicket:function(){var t=$("[mp-role=TicketsGroup]");if(1==t.length){var e=t.eq(0),i=e.find("[mp-role=TicketItem]"),o=e.parents("[mp-role=TicketTypeTitleLink]");i.length>0&&0==o.length&&e.parents("[mp-role=PriceListItem]").addClass("mp-ticket-list-expand")}},openDetailWindow:function(){var t=ptouch.getParamFromUrl("tid");if(""!=t){for(var e=0,i=null,o=this.container.find("[mp-role=PriceListItem]"),n=0;n<o.length;n++)if($(o[n]).data("typeid")==t){e=$(o[n]).offset().top,this.window_.scrollTop(e),i=$(o[n]);break}null!=i&&i.find("[mp-role=TicketMainZone]").eq(0).click()}},addAnalysisParam:function(){var t,e,i,o,n,a,r=this.container.find("[mp-role=PriceListItem]"),s={};this.container.find("[mp-role=TicketLink]").each(function(){t=$(this),(e=t.attr("href"))&&(a=t.parents("[mp-role=PriceListItem]"),i=t.parents("[mp-role=TicketItem]").index()+1,n=a.attr("data-typeid"),o=r.index(a)+1,i&&(s.pIndex=i),o&&(s.typeIndex=o),n&&(s.typeId=n),e=ptouch.Analytics.makeAnalyticsLink(e,s),t.attr("href",e))})},handleTicketTypeTitleClick:function(t){$(t.currentTarget).parent().toggleClass("mp-ticket-list-expand")},handleOrderLinkClick:function(t){t.preventDefault();var e=$(t.currentTarget),i=e.role("downloadAppBtn").attr("data-app");"app"!=$.env.platform&&i?window.location.href=e.attr("href"):this.preHandleOrderLinkClick(e)},selectCategory:function(t){this.categoryPopup||(this.categoryPopup=new ptouch.Dock("page-category"),this.categoryPopup.render("#main-page"),$(this.categoryPopup).listen("closeOneDock",this.handleCloseCategoryCover,this)),this.categoryCoverElem||(this.categoryCoverElem=$('<div class="mpg-mask"></div>'),this.pageContainer.append(this.categoryCoverElem),this.categoryCoverElem.listen("click",this.handleCloseCategoryCover,this));var e=t.attr("href"),i=t.attr("data-cashbackamount");i&&"0"!=i&&(i="");var o=ptouch.getParam(e,"pid"),n=ptouch.getParam(e,"classify");this.category||(this.category=new ptouch.Category(ptouch.API_PRODUCT_CATEGORY),$(this.category).listen("renderCategory",this.handleRenderCategory,this),$(this.category).listen("categoryCloseCover",this.handleCloseCategoryCover,this),$(this.category).listen("selectDate",$.proxy(this.category.dealBookBtnAndPrice,this.category))),this.category.showPromptMsg("加载中，请稍等"),this.category.init(o,0,n,e,i)},handleRenderCategory:function(t){this.categoryPopup.show();var e=t.target.data,i="";if(e){i=$(QTMPL.category.render(e));var o=t.target.defaultDateMap;if(o){var n=QTMPL.calendarcategory.render(o);i.find("[data-type='CALENDAR']").append(n)}}else i='<div class="detail_des theme_dark" style="padding:10px;">暂无信息</div>';this.categoryPopup.setContent(i),this.categoryCoverElem.show(),this.category.attachEvent("#alldate");var a=$.role("dateshortcutkey");a.length?this.category.setDateShorKey(a.eq(0)):this.category.openDatePanel()},handleCloseCategoryCover:function(t){$(document).trigger("closeAllDock"),this.categoryCoverElem.hide(),t.stopPropagation()}}),$.provide("ptouch.sight.detail.Page"),ptouch.sight.detail.Page=function(t){ptouch.Page.call(this,t)},$.inherits(ptouch.sight.detail.Page,ptouch.Page),$.extend(ptouch.sight.detail.Page.prototype,{init_:function(){this.setHeader(this.context.sightName,!0),this.initTicketPrice(),this.purchase=new ptouch.Purchase,this.container=this.view.getElement(),this.container.role("lazyLoadImg").lazyload({data_attribute:"original-src",failure_limit:9999}),this.resetAnalyticsLink(),this.initCommentFold(),this.bindEvents()},resetAnalyticsLink:function(){for(var t=this.container.role("commentLink"),e=this.container.role("sightLink"),i=0;i<t.length;i++)(o=t.eq(i)).attr("href",ptouch.Analytics.makeAnalyticsLink(o.attr("href")));for(i=0;i<e.length;i++){var o=e.eq(i);o.attr("href",ptouch.Analytics.makeAnalyticsLink(o.attr("href")))}},initCommentFold:function(){for(var t=$.role("commentContent"),e=0;e<t.length;e++){var i=$(t[e]);i.height()>105&&(i.css({height:"105px",overflow:"hidden"}),i.after($('<div class="mp-comment-foldbtn mp-iconfont" data-status="fold" mp-role="commentFoldBtn">E</div>')))}$.role("commentFoldBtn").listen("click",this.hansleExtendComment,this)},hansleExtendComment:function(t){var e=$(t.currentTarget),i=$.role("commentFoldBtn").index(e),o=$.role("commentContent")[i];"fold"==e.data("status")?(e.data("status","extend").addClass("mp-comment-foldbtn-extend"),$(o).css({height:"auto",overflow:"auto"})):(e.data("status","fold").removeClass("mp-comment-foldbtn-extend"),$(o).css({height:"105px",overflow:"hidden"}))},bindEvents:function(){var t=this.container.find("#imgcontainer"),e=this.container.find("#card-adress"),i=this.container.find("#mp-announce-con"),o=this.container.role("scrollImages"),n=o.role("lazyLoadImg");$.listen(t,"click",this.handleImageClick,this),$.listen(e,"click",this.handleMapClick,this),$.listen(o,"scroll",this.handleImgsScroll,this),$.listen(n,"click",this.handleThumbClick,this),0!=i.length&&(this.renderAnnouncement(window.context.spotAnnouncement),i.listen("click",this.handleAnnouncementClick,this))},handleImgsScroll:function(){$(window).trigger("scroll")},handleThumbClick:function(t){target=$(t.target);for(var e,i=target.index(),o=target.parent().parent().parent().role("lazyLoadImg"),n=[],a=[],r=0,s=o.length;r<s;r++)e=o.eq(r),n.push(e.attr("data-bigimg")),a.push(e.attr("data-original-src"));this.handleShowCommentsBigImg(a,n,i)},handleShowCommentsBigImg:function(t,e,i){for(var o,n=[],a=0,r=e.length;a<r;a++)n.push({url:e[a],smallUrl:t[a],title:""});(o=new ptouch.ui.PictureSlider(n)).create("body"),o.setIndex(i,!0)},handleImageClick:function(t){for(var e=[],i=window.context.bigImages,o=window.context.smallImages,n=0,a=i.length;n<a;n++)e.push({url:i[n],smallUrl:o[n],title:""});var r=new ptouch.ui.PictureSlider(e);r.create("body"),r.setIndex(0)},initTicketPrice:function(){this.ticketPrice=new ptouch.sight.detail.TicketPrice(this.view.element),this.ticketPrice.init()},handleMapClick:function(t){var e,i=window.context.baiduPoint.split(","),o=i[1],n=i[0];e="app"==$.env.platform?$.env.scheme+"://sight/detailMap?sightId="+this.context.sightId:"/touch/weekend/sightmap.htm?sightname="+this.context.sightName+"&lat="+o+"&lng="+n,window.location.href=ptouch.Analytics.makeAnalyticsLink(e)},renderAnnouncement:function(t){var t=t.replace(/<br\/>/g,"").replace(/</g,"&lt;").replace(/>/g,"&gt;");this.container.find(".mp-announce-icon").after(t)},handleAnnouncementClick:function(){this.announcementPop?($("#mp-announce-mask").show(),$("#mp-announce-detailcon").show()):(window.context.spotAnnouncement=window.context.spotAnnouncement.split("<br/>"),this.announcementPop=QTMPL.announce.render({spotAnnouncement:window.context.spotAnnouncement}),$(document.body).append(this.announcementPop),$("#mp-announce-detailclose").listen("click",this.hideAnnouncementPop,this))},hideAnnouncementPop:function(){$("#mp-announce-mask").hide(),$("#mp-announce-detailcon").hide()}});